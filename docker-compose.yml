version: '2.2'
services:
  consul:
    image: dtr.mapsandbox.net/ckm/consul-server:1.0.0
    command: "consul agent -server -bootstrap-expect=1 -ui -client 0.0.0.0 -data-dir /consul/data -config-dir /consul/config"
    volumes:
     - "/consul/data"
     - "/consul/config"
    ports:
     - "8500:8500"
     - "8600:8600/udp"

  # Registrator is a special container that monitors and registers other containers in Consul.
  # https://github.com/gliderlabs/registrator

  registrator:
    image: mobileapps.vaftl.us:9250/md/map/registrator:1.1.1
    command: "-tags local -internal consul://consul:8500"
    volumes: 
    - /var/run/docker.sock:/tmp/docker.sock
    environment:
     - CONSUL_HTTP_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
    links:
    - consul

  apigateway:
    image: mobileapps.vaftl.us:9250/md/apigateway:1.3.3
    restart: on-failure:5
    ports:
      - "8089:80"
      - "80:80"
    environment:
    - CONSUL_HTTP_ADDR=consul:8500
    - VAMF_ENVIRONMENT=local 
    - USERSVC_URL=http://user-services:8080/users/v1/session/jwt
    - JWT_SECRET=testtesttest
    - SERVICE_80_NAME=apigateway
    - CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
    - "REGEX_AUTH_PROXY=.*"
    - "REGEX_RESTRICTED_HEADER=((^va_)|(^eauth_))/i"
    - "REGEX_EXCLUDE_JWT_URL=((js$$)|(css$$)|(gif$$)|(jpg$$)|(^/users)|(^/saml)|(^/eula))"
    - "TRACE_URL=http://zipkin:9411/api/v1/spans"
    links:
    - registrator
    - consul
    - user-services
    - adr-services
    - roa-services
    - zipkin
    - database
    - pgd-fhir-services
    - fit-heart-web


  # Mock for VIA data service
  mock-via:
    image: dtr.mapsandbox.net/ckm/via-mock-service:1.0.11
    ports:
      - 8080:8080

  via-mock:
    image: dtr.mapsandbox.net/ckm/via-mock-service:1.0.11
    ports:
      - 8380:8080

  ### MDWS to VIA adapter
  mdws-via-adapter:
    image: dtr.mapsandbox.net/mdws-via-adapter:1.2.12
    links:
    - mock-via
    - user-services
    - tredis
    ports:
    - 8180:8180
    environment:
    # Vault 
    #- "VAULT_ADDR=http://vault:8200"
    #- "SECRET_PATH=secret/local/mdws-via-adapter"
    # Use Consul 
    - "USE_ENVCONSUL=true"
    - "CONSUL_SERVER=consul:8500"
    - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
    - "CONSUL_PATH=appconfig/local/mdws-via-adapter"
    - VIA_BASE_URL=http://mock-via:8080/via-webservices/via-webservices/services
    - JAVA_OPTS=-Xms256m -Xmx512m -XX:-TieredCompilation -Xss256k -XX:+UseG1GC -XX:+UseStringDeduplication
    - TRUSTSTORE_PASSWORD=changeit
    - REDIS_HOST=tredis
    - JWT_REQUIRED_ROLE=STAFF
    - USER_SVC_URL=http://user-services:8080/users/v1
    - JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB

  # Right of Access (ROA) service and oracle DB mock. ROA is an internal service that allows veterans to review and grant
  # access to their medical information. Veteran users must complete ROA before they can use any other mobile app.
  #
  mock-roa:
    image: dtr.mapsandbox.net/md/map/docker-roa-mock:1.0.3
    #image: roa-mock-test
    ports:
     - "1521:1521"

  roa-services:
    image: dtr.mapsandbox.net/md/map/docker-roa-service:1.0.11
    restart: on-failure
    links:
    - mock-roa
    - vault
    depends_on: 
     - mock-roa
    ports:
     - "8086:8080"
    environment:
    # Use Vault
    - VAULT_ADDR=http://vault:8200
    - SECRET_PATH=secret/local/roa-service
    # Use Consul  
    - USE_ENVCONSUL=true
    - CONSUL_SERVER=consul:8500
    - CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
    - CONSUL_PATH=appconfig/local/roa-service
    #- DB_ROA_USERNAME=HADB # pulled from vault
    #- DB_ROA_PASSWORD=m0ckpass01 # pulled from vault
    - SERVICE_TAGS=local
    - JAVA_OPTS=-Xms256m -Xmx512m -XX:-TieredCompilation -Xss256k -XX:+UseG1GC -XX:+UseStringDeduplication
    - JWT_SECRET=testtesttest
    - DB_ROA_URL=jdbc:oracle:thin:@mock-roa:1521:xe 
    - VAMF_ENVIRONMENT=local
    #- JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB

  # User service and Mobile Veteran (Patient) Index (MVI/MPI)- The user service is responsible for processing requests
  # to create JWT security tokens and augmenting user identities with other identifiers from the MVI (specifically ICN)
  #
  mock-mvi:
    image: dtr.mapsandbox.net/ckm/docker-mvi-mock:1.0.7

  docker-mvi-user-service:
    image: dtr.mapsandbox.net/ckm/docker-mvi-mock:1.0.7
    ports:
      - "1443:1443"

  # Mock for IAM SAML token
  mock-wstrust:
    image: dtr.mapsandbox.net/ckm/sts-mock:1.0.0

  user-services:
    image: dtr.mapsandbox.net/md/docker-user-services:1.7.0
    links:
      - mock-mvi
      - roa-services
      - sud-service
      - zipkin
      - vault
      - redis
      - mock-wstrust
      - eula-services_v1
      - ssoi-mock
      - pie-cdw-mock
      - cdw-service
    depends_on:
      - mock-mvi
    ports:
      - "8081:8080"
    environment:
      # Use Vault
      - VAULT_ADDR=http://vault:8200
      - SECRET_PATH=secret/local/user-services
      # Use Consul
      - USE_ENVCONSUL=true
      - CONSUL_SERVER=consul:8500
      - CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
      - CONSUL_PATH=appconfig/local/user-services
      - SERVER_USE_FORWARD_HEADERS=false
      - SERVICE_NAME=docker-user-service
      - TRACE_URL=http://zipkin:9411/api/v1/spans
      - MVI_URL=http://mock-mvi:8080/mvi/mockVAIdMPort
      - ROA_HOST=http://roa-services:8080
      - SUD_HOST=http://sud-service:8080
      - MVI_SENDER_ID=CIH200
      - MCI_PROCESSING_CODE=T
      #- JWT_SECRET=testtesttest
      #- JWT_PRIVATE_KEY=MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDBGzt361EC4riygMie4qnnWVNNNdY3yiRdHf+BIeIgH6ru9l4AZYDxQuMJi4QIt17y1Lo7HNnBKP+gzSRkFe4cpira6RYqNMSY7CWlBbi8GlfrRtzHmtfCgSNtxaCEr2hVbBjg7BsAnhNiSWRQdkLlu5D7xFTn27oUhZK/Y3cP1UGR9iwe+nc7hpdVoTx1nR3GV1R2/9Z4+guQJ5RiAuwbIOD/Oxm8OtfX7K82yM02YH+SwlKim0y/0J/JSlJex+i/7waEEK2DMO+CffaTDv3A+ytOSCcLQNG26/7LeoJdf5knpxsnfW1W6z0Bp1SfYKtYm6vr8pFiyeJBoSd8DjeHAgMBAAECggEATcnKiuQgHil2fXGjX12vU6KIC/JD+PVU8K3E3x/nF0mqcdiMxVweNRHco1uwNFKpzOgknOtiTI1XbE82+Zpb8O5/FPAQHbBkAbYe8/r6D8wM3poNFdsqTw/2VaHmp4yBWufQncp+liEXbeBiqIb7K9AC92h/S2cX7mxgUPigXZ+2V5Bvdjo2jAtdrq6nXFtzsqCxNKFpFifdV2TkFbq6vGB/mJdrFHspUiMZc2KAR7/pQCO/oR/WIyHRTBvWcM/zrd/7A6TZRKYMabYDn1dbyP/ATqyJ/rtx+7Josj+LogBVrdeD7USpdHj6FLbT/Z0N5o1tintUlj8eo1XqNupjAQKBgQD2VLTgiVphbju0YA65I1yWYuPYdDXJVkJjqv7lFndPdOGZsfysdc2fdkdAEkPVZhI5Tve8CvOW98WnVLkj/WRyfBVeVbekIGdsH/PWRTrLv5mXbpDGYP0z1c7FTMx6qiaE6ZLZATy4jWBLRPQcJj5rm70nO4Sajfo5TQW4BB+abQKBgQDIr7Dvq5AixiMSzbvhPIDqjIYQv+TCbzKoNm/JuRgE/1mxfgxuthNA8OLDBEmCa3SWUo9Slrq5KnynVMnxIMiTw9CSbLhUYxqlrP0ei6C7d1bv5N3tH4GD5ljCmobz04Dg56/bs/pbfJBjfE2qxtrEgzK51FazUzlFUwzf++vhQwKBgQCCUuRzWxfvLjP2RU/k0XmdsuoazbjbMYDkXEaJC27KIetttkYZNCY6tIgTtNYgo+UGXuogmaawe5wd4GwnR1uKWm2vwCftdJtjEDCgb3Yg79ihzoRYAF5Vu0uvBOe2Cilg7nabytTGSz3j9LI15mHl6rqTdCC+6Fi3UjGxXrUdrQKBgQCjPF0EJZ2A239N3TA0Hd2Saqjl2OA+0un2bwjwoPCLqBQRzkBYkRsKGKWqEMOmJLdZSmAvwlCxKoDoLoxv6MWdg4oUgABTC6VyG0pr3RDpS0HYsWVeaeEUI3oRGFYq39+VkH63iyZZ4fEkKsiV31e0vi61fqTjCg+sdsgjLCuKNwKBgQDhp8wfpcqYnvDvn7OKL52SiXfktTWe8xq6pVKLDrHScEUhj/vgcXkvOiELP+jnNivMU2AWObLq0Nf+JWpH4HrIH8R+Ag7sgy+mL53Ku+4I2et1JsHCc94AS59qY/C4AqZDgpFAFYKTNPRn+bQMAIRCh2dIayehKTgZpvhmxxSSvw==
      #- JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB
      - JAVA_OPTS=-Xms256m -Xmx512m -XX:-TieredCompilation -Xss256k -XX:+UseG1GC -XX:+UseStringDeduplication
      - SERVICE_TAGS=local
      - APIGW_BASE_URL=http://localhost:8089
      - WAYF_APP_URL=http://localhost:8089/wayf/v1/index.html
      - "MVI_VISTA_FACILITIES=101,111,222,313,372,376,442,500,516,553,631,688,777"
      - "JAVA_OPTS=-agentlib:jdwp=transport=dt_socket,address=8000,server=y,suspend=n"
      - "JWTISSUER_CONFIG_JSON=[{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"gov.va.mhv.idp.v1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"external.idp.test1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA17igsXGfpg3BRv1dr9jAyhyjGUpDSQ1CCIjQI/NZD+OoxoTlvPMmY8yQ3OfisnpE7zR+dNAdj7CHCiCbKgQKjPmOzdobKJD7N8538lxZ2wlHNko0rG3iyCKJVRJFMXirZfrPERlFj0AQrwhobIpuwyFQfsNTZPaxeaN35Bexo7fowu0LBkzvCioZfKq6QPxx8qQ0/wJYxeh3D4b5NWR1eIbWpJE5NbWYx0ZSs/TD5HQTAGsIvJN5+EKzVB1RZAp0UwdxDQE7BjpXBXx0PjZidCY2kH2jVm1OHd/xzkZiIt2EYe5Cpd/CuLfWjzxHv6pCkC8I0a6qljQNS9iOQc6blwIDAQAB\",\"iss\":\"gov.va.vamf.service.saml-sts\",\"userType\":\"VETERAN\"}]"
      - "IDP_CONFIG_JSON=[{\"idpId\": \"gov.va.iam.ssoe.v1\",\"friendlyName\": \"VAAFI SSOe\",\"description\": \"Veteran login supporting DSLogon, Symantec, and other CSPs.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/dslogon-logo.png\",\"loginUrl\": \"http://localhost:9000/ssoeproxy/veteran/authorize\",\"logoutUrl\": \"http://localhost:9000/ssoeproxy/logout\",\"vamfLandingPage\": \"http://localhost:9000/users/v1/landing\"},{\"idpId\": \"gov.va.iam.ssoi.v1\",\"friendlyName\": \"VAAFI SSOi\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"STAFF\",\"logoUrl\": \"img/logo_navbar_ipad.png\",\"loginUrl\": \"http://localhost:9001/jwt\",\"logoutUrl\": \"http://localhost:9001/ssoiproxy/logout\",\"vamfLandingPage\": \"http://localhost:9001/users/v1/landing\"},{\"idpId\": \"gov.va.mhv.v1\",\"friendlyName\": \"My HealtheVet\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/mhv-logo.png\",\"loginUrl\": \"http://localhost:9001/jwt\",\"logoutUrl\": \"http://localhost:9001/logout\",\"vamfLandingPage\": \"http://localhost/users/v1/landing\"}]"
      - "VAMF_ENVIRONMENT=local"
      - "REDIS_HOST=redis"
      - "IAM_WST_URL=http://mock-wstrust:8080/services/sts"

  # Administrative Data Repository (ADR) Service and Mock (SOAP) data source. ADR serves as a enterprise data service
  # that allows VA apps to retrieve patient demographic and next-of-kin information
  mock-adr:
    image: dtr.mapsandbox.net/md/map/docker-adr-mock:1.2.1
    container_name: mock-adr
    volumes:
      - ./healthchecks:/opt/healthchecks
    environment:
      - "CATALINA_OPTS=-Xms64m -Xmx170m -XX:+UseSerialGC"
    ports:
      - "8090:8080"
    healthcheck:
      test: ["CMD", "bash", "/opt/healthchecks/healthcheck-adr.sh"]
      interval: 15s
      timeout: 5s
      retries: 3

  adr-services:
    image: dtr.mapsandbox.net/ckm/adr-service:2.1.2
    container_name: adr-service
    ports:
      - "8083:8080"
    links:
      - mock-adr
      - zipkin
    depends_on:
      - mock-adr
    environment:
      - VAMF_ENVIRONMENT=${VAMF_ENVIRONMENT}
      # Don't use Vault, ADR doesn't have any secrets in local-dev
      #- VAULT_ADDR=http://vault:8200
      #- SECRET_PATH=secret/local/adr-service
      # Use Consul
      - JWT_PRIVATE_KEY=MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDBGzt361EC4riygMie4qnnWVNNNdY3yiRdHf+BIeIgH6ru9l4AZYDxQuMJi4QIt17y1Lo7HNnBKP+gzSRkFe4cpira6RYqNMSY7CWlBbi8GlfrRtzHmtfCgSNtxaCEr2hVbBjg7BsAnhNiSWRQdkLlu5D7xFTn27oUhZK/Y3cP1UGR9iwe+nc7hpdVoTx1nR3GV1R2/9Z4+guQJ5RiAuwbIOD/Oxm8OtfX7K82yM02YH+SwlKim0y/0J/JSlJex+i/7waEEK2DMO+CffaTDv3A+ytOSCcLQNG26/7LeoJdf5knpxsnfW1W6z0Bp1SfYKtYm6vr8pFiyeJBoSd8DjeHAgMBAAECggEATcnKiuQgHil2fXGjX12vU6KIC/JD+PVU8K3E3x/nF0mqcdiMxVweNRHco1uwNFKpzOgknOtiTI1XbE82+Zpb8O5/FPAQHbBkAbYe8/r6D8wM3poNFdsqTw/2VaHmp4yBWufQncp+liEXbeBiqIb7K9AC92h/S2cX7mxgUPigXZ+2V5Bvdjo2jAtdrq6nXFtzsqCxNKFpFifdV2TkFbq6vGB/mJdrFHspUiMZc2KAR7/pQCO/oR/WIyHRTBvWcM/zrd/7A6TZRKYMabYDn1dbyP/ATqyJ/rtx+7Josj+LogBVrdeD7USpdHj6FLbT/Z0N5o1tintUlj8eo1XqNupjAQKBgQD2VLTgiVphbju0YA65I1yWYuPYdDXJVkJjqv7lFndPdOGZsfysdc2fdkdAEkPVZhI5Tve8CvOW98WnVLkj/WRyfBVeVbekIGdsH/PWRTrLv5mXbpDGYP0z1c7FTMx6qiaE6ZLZATy4jWBLRPQcJj5rm70nO4Sajfo5TQW4BB+abQKBgQDIr7Dvq5AixiMSzbvhPIDqjIYQv+TCbzKoNm/JuRgE/1mxfgxuthNA8OLDBEmCa3SWUo9Slrq5KnynVMnxIMiTw9CSbLhUYxqlrP0ei6C7d1bv5N3tH4GD5ljCmobz04Dg56/bs/pbfJBjfE2qxtrEgzK51FazUzlFUwzf++vhQwKBgQCCUuRzWxfvLjP2RU/k0XmdsuoazbjbMYDkXEaJC27KIetttkYZNCY6tIgTtNYgo+UGXuogmaawe5wd4GwnR1uKWm2vwCftdJtjEDCgb3Yg79ihzoRYAF5Vu0uvBOe2Cilg7nabytTGSz3j9LI15mHl6rqTdCC+6Fi3UjGxXrUdrQKBgQCjPF0EJZ2A239N3TA0Hd2Saqjl2OA+0un2bwjwoPCLqBQRzkBYkRsKGKWqEMOmJLdZSmAvwlCxKoDoLoxv6MWdg4oUgABTC6VyG0pr3RDpS0HYsWVeaeEUI3oRGFYq39+VkH63iyZZ4fEkKsiV31e0vi61fqTjCg+sdsgjLCuKNwKBgQDhp8wfpcqYnvDvn7OKL52SiXfktTWe8xq6pVKLDrHScEUhj/vgcXkvOiELP+jnNivMU2AWObLq0Nf+JWpH4HrIH8R+Ag7sgy+mL53Ku+4I2et1JsHCc94AS59qY/C4AqZDgpFAFYKTNPRn+bQMAIRCh2dIayehKTgZpvhmxxSSvw==
      - JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB
      - "JWTISSUER_CONFIG_JSON=[{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"gov.va.mhv.idp.v1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"external.idp.test1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA17igsXGfpg3BRv1dr9jAyhyjGUpDSQ1CCIjQI/NZD+OoxoTlvPMmY8yQ3OfisnpE7zR+dNAdj7CHCiCbKgQKjPmOzdobKJD7N8538lxZ2wlHNko0rG3iyCKJVRJFMXirZfrPERlFj0AQrwhobIpuwyFQfsNTZPaxeaN35Bexo7fowu0LBkzvCioZfKq6QPxx8qQ0/wJYxeh3D4b5NWR1eIbWpJE5NbWYx0ZSs/TD5HQTAGsIvJN5+EKzVB1RZAp0UwdxDQE7BjpXBXx0PjZidCY2kH2jVm1OHd/xzkZiIt2EYe5Cpd/CuLfWjzxHv6pCkC8I0a6qljQNS9iOQc6blwIDAQAB\",\"iss\":\"gov.va.vamf.service.saml-sts\",\"userType\":\"VETERAN\"}]"
      - "IDP_CONFIG_JSON=[{\"idpId\": \"gov.va.iam.ssoe.v1\",\"friendlyName\": \"VAAFI SSOe\",\"description\": \"Veteran login supporting DSLogon, Symantec, and other CSPs.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/dslogon-logo.png\",\"loginUrl\": \"http://${HOST_DOMAIN}:9000/users/v1/landing\",\"logoutUrl\": \"http://iamssoe-proxy-mock/ssoeproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}:9000/ssoeproxy/logout\"},{\"idpId\": \"gov.va.iam.ssoi.v1\",\"friendlyName\": \"VAAFI SSOi\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"STAFF\",\"logoUrl\": \"img/logo_navbar_ipad.png\",\"loginUrl\": \"http://localhost:9001/users/v1/landing\",\"logoutUrl\": \"http://${HOST_DOMAIN}:9001/ssoiproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}/users/v1/landing\"},{\"idpId\": \"gov.va.mhv.v1\",\"friendlyName\": \"My HealtheVet\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/mhv-logo.png\",\"loginUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/login\",\"logoutUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}:8080/users/v1/landing\"}]"
      - USE_ENVCONSUL=true
      - CONSUL_SERVER=consul:8500
      - CONSUL_TOKEN=$CONSUL_MASTER_TOKEN
      - CONSUL_PATH=appconfig/${VAMF_ENVIRONMENT}/adr-service
      - CORS_ALLOWED_ORIGIN=*
      - SERVICE_TAGS=${VAMF_ENVIRONMENT}
      - SERVICE_NAME=adr-service
      - "JAVA_OPTS=-Xms64m -Xmx170m -XX:+UseSerialGC"

  fit-heart-web:
    container_name: fit-heart-web
    image: fit-heart:2.0.24
    ports:
    - 8070:80
    environment:
    - SERVICE_TAGS=local
    - SERVICE_80_NAME=fit-heart-web

  ## ROA WEB
  roa-web:
    container_name: roa-web
    image: dtr.mapsandbox.net/md/map/docker-roa-web:latest
    ports:
      - "8087:80"
    environment:
      - SERVICE_TAGS=${VAMF_ENVIRONMENT}
      - SERVICE_NAME=roa-web

  ## Swagger UI for working with contracts
  swagger-ui:
    image: swaggerapi/swagger-ui
    ports:
     - "8091:8080"

  # Where Are You From? (WAYF) web App. WAYF is a CSS/HTML/JS client-side web application.
  wayf-web:
    image: dtr.mapsandbox.net/ckm/wayf-app:1.0.3
    container_name: wayf-web
    ports:
      - 8092:80
    environment:
      - SERVICE_TAGS=${VAMF_ENVIRONMENT}
      - SERVICE_80_NAME=wayf-web

  eula-web:
    image: dtr.mapsandbox.net/ckm/eula-web:1.0.4
    ports:
      - 8101:80
    environment:
      - SERVICE_NAME=eula-web
      - SERVICE_TAGS=local

  ppms-mock:
    image: ppms-mock:1.0
    ports:
      - 8101:80
    environment:
      - SERVICE_NAME=ppms-mock
      - SERVICE_TAGS=local

  # Provider Context Selector (PCS) Web App. PCS is a CSS/HTML/JS client-side web application.
  pcs-web:
    image: dtr.mapsandbox.net/ckm/pcs-web:1.1.4
    ports:
    - 8093:80
    environment:
    - SERVICE_TAGS=local
    - SERVICE_80_NAME=pcs-web

  # SUD Service
  sud-service:
    container_name: sud-service
    image: dtr.mapsandbox.net/md/docker-sud-service:latest
    restart: on-failure
    links:
      - mock-roa
    environment:
      # Use Vault
      # - VAULT_ADDR=http://vault:8200
      # - SECRET_PATH=secret/local/sud-service
      # Use consul
      - USE_ENVCONSUL=true
      - CONSUL_SERVER=consul:8500
      - CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
      - CONSUL_PATH=appconfig/local/sud
      - DB_SUD_URL=jdbc:oracle:thin:@//mock-roa:1521/xe
      - DB_SUD_USERNAME=HADB
      - DB_SUD_PASSWORD=m0ckpass01
      - JWT_PRIVATE_KEY=MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDBGzt361EC4riygMie4qnnWVNNNdY3yiRdHf+BIeIgH6ru9l4AZYDxQuMJi4QIt17y1Lo7HNnBKP+gzSRkFe4cpira6RYqNMSY7CWlBbi8GlfrRtzHmtfCgSNtxaCEr2hVbBjg7BsAnhNiSWRQdkLlu5D7xFTn27oUhZK/Y3cP1UGR9iwe+nc7hpdVoTx1nR3GV1R2/9Z4+guQJ5RiAuwbIOD/Oxm8OtfX7K82yM02YH+SwlKim0y/0J/JSlJex+i/7waEEK2DMO+CffaTDv3A+ytOSCcLQNG26/7LeoJdf5knpxsnfW1W6z0Bp1SfYKtYm6vr8pFiyeJBoSd8DjeHAgMBAAECggEATcnKiuQgHil2fXGjX12vU6KIC/JD+PVU8K3E3x/nF0mqcdiMxVweNRHco1uwNFKpzOgknOtiTI1XbE82+Zpb8O5/FPAQHbBkAbYe8/r6D8wM3poNFdsqTw/2VaHmp4yBWufQncp+liEXbeBiqIb7K9AC92h/S2cX7mxgUPigXZ+2V5Bvdjo2jAtdrq6nXFtzsqCxNKFpFifdV2TkFbq6vGB/mJdrFHspUiMZc2KAR7/pQCO/oR/WIyHRTBvWcM/zrd/7A6TZRKYMabYDn1dbyP/ATqyJ/rtx+7Josj+LogBVrdeD7USpdHj6FLbT/Z0N5o1tintUlj8eo1XqNupjAQKBgQD2VLTgiVphbju0YA65I1yWYuPYdDXJVkJjqv7lFndPdOGZsfysdc2fdkdAEkPVZhI5Tve8CvOW98WnVLkj/WRyfBVeVbekIGdsH/PWRTrLv5mXbpDGYP0z1c7FTMx6qiaE6ZLZATy4jWBLRPQcJj5rm70nO4Sajfo5TQW4BB+abQKBgQDIr7Dvq5AixiMSzbvhPIDqjIYQv+TCbzKoNm/JuRgE/1mxfgxuthNA8OLDBEmCa3SWUo9Slrq5KnynVMnxIMiTw9CSbLhUYxqlrP0ei6C7d1bv5N3tH4GD5ljCmobz04Dg56/bs/pbfJBjfE2qxtrEgzK51FazUzlFUwzf++vhQwKBgQCCUuRzWxfvLjP2RU/k0XmdsuoazbjbMYDkXEaJC27KIetttkYZNCY6tIgTtNYgo+UGXuogmaawe5wd4GwnR1uKWm2vwCftdJtjEDCgb3Yg79ihzoRYAF5Vu0uvBOe2Cilg7nabytTGSz3j9LI15mHl6rqTdCC+6Fi3UjGxXrUdrQKBgQCjPF0EJZ2A239N3TA0Hd2Saqjl2OA+0un2bwjwoPCLqBQRzkBYkRsKGKWqEMOmJLdZSmAvwlCxKoDoLoxv6MWdg4oUgABTC6VyG0pr3RDpS0HYsWVeaeEUI3oRGFYq39+VkH63iyZZ4fEkKsiV31e0vi61fqTjCg+sdsgjLCuKNwKBgQDhp8wfpcqYnvDvn7OKL52SiXfktTWe8xq6pVKLDrHScEUhj/vgcXkvOiELP+jnNivMU2AWObLq0Nf+JWpH4HrIH8R+Ag7sgy+mL53Ku+4I2et1JsHCc94AS59qY/C4AqZDgpFAFYKTNPRn+bQMAIRCh2dIayehKTgZpvhmxxSSvw==
      - JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB
      - "JWTISSUER_CONFIG_JSON=[{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"gov.va.mhv.idp.v1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"external.idp.test1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA17igsXGfpg3BRv1dr9jAyhyjGUpDSQ1CCIjQI/NZD+OoxoTlvPMmY8yQ3OfisnpE7zR+dNAdj7CHCiCbKgQKjPmOzdobKJD7N8538lxZ2wlHNko0rG3iyCKJVRJFMXirZfrPERlFj0AQrwhobIpuwyFQfsNTZPaxeaN35Bexo7fowu0LBkzvCioZfKq6QPxx8qQ0/wJYxeh3D4b5NWR1eIbWpJE5NbWYx0ZSs/TD5HQTAGsIvJN5+EKzVB1RZAp0UwdxDQE7BjpXBXx0PjZidCY2kH2jVm1OHd/xzkZiIt2EYe5Cpd/CuLfWjzxHv6pCkC8I0a6qljQNS9iOQc6blwIDAQAB\",\"iss\":\"gov.va.vamf.service.saml-sts\",\"userType\":\"VETERAN\"}]"
      - "IDP_CONFIG_JSON=[{\"idpId\": \"gov.va.iam.ssoe.v1\",\"friendlyName\": \"VAAFI SSOe\",\"description\": \"Veteran login supporting DSLogon, Symantec, and other CSPs.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/dslogon-logo.png\",\"loginUrl\": \"http://${HOST_DOMAIN}:9000/users/v1/landing\",\"logoutUrl\": \"http://iamssoe-proxy-mock/ssoeproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}:9000/ssoeproxy/logout\"},{\"idpId\": \"gov.va.iam.ssoi.v1\",\"friendlyName\": \"VAAFI SSOi\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"STAFF\",\"logoUrl\": \"img/logo_navbar_ipad.png\",\"loginUrl\": \"http://localhost:9001/users/v1/landing\",\"logoutUrl\": \"http://${HOST_DOMAIN}:9001/ssoiproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}/users/v1/landing\"},{\"idpId\": \"gov.va.mhv.v1\",\"friendlyName\": \"My HealtheVet\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/mhv-logo.png\",\"loginUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/login\",\"logoutUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}:8080/users/v1/landing\"}]"
      - APP_LOGGING_LEVEL=INFO
      - ROOT_LOGGING_LEVEL=INFO
      - VAMF_ENVIRONMENT=${VAMF_ENVIRONMENT}
      - "JAVA_OPTS=-Xms64m -Xmx170m -XX:+UseSerialGC"
    ports:
      - 8095:8080

  # SUD Web Application
  sud-web:
    container_name: sud-web
    image: dtr.mapsandbox.net/md/docker-sud-web:1222
    ports:
      - 8096:80

  #SAML mock
  mock-saml-idp:
    image: dtr.mapsandbox.net/ckm/mock-saml-idp:1.0.1
    ports:
    - 8900:8080
    environment:
    - SERVICE_TAGS=local
  # SAML Secure Token Service (STS) for exchanging myhealth.va.gov SAML tokens for VAMF JWTs
  saml-sts:
    image: dtr.mapsandbox.net/saml-sts:1.2.8
    ports:
    - 80:8080
    environment:
    - SERVER_USE_FORWARD_HEADERS=true
    - STS_EXTERNAL_ADDR=http://ec2-54-152-177-13.compute-1.amazonaws.com
    - "STS_SP_PUBLICKEY=MIIDkTCCAnmgAwIBAgIJAO5DUXArAG/VMA0GCSqGSIb3DQEBBQUAMDkxNzA1BgNVBAMTLm1vY2stc2FtbC1pZHAsZGM9c2VydmljZXMsZGM9dmFtZixkYz12YSxkYz1nb3YwHhcNMTcwNjMwMDExNDA3WhcNMzcwNjMwMDExNDA3WjA5MTcwNQYDVQQDEy5tb2NrLXNhbWwtaWRwLGRjPXNlcnZpY2VzLGRjPXZhbWYsZGM9dmEsZGM9Z292MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsyEeemzH9sVeyaXziWaXRw1pG7uLkr/pT4NBfNF/Ejcsj/Kbvbi7WK4i1g2w/3R9CdVPCFtHBMpcI2uN5Z5blSqwBulJ9BMF/HAp7ImYQhMuZLzgy7iA7z1rdLzzmqvVTPeGm1SjNuc0J2fe/+s/HhJJ+Xo5+v4EeZNegDzyEVpHc9PQzQjmLzPnjNsAWVy/jBmwQPoV3VcGDWkccaxVwcS6OS/oGTxs1Ax4dKvfGqf+/IuVFyBrWniLLdiwtupROBvxK8X6D+GyLY0o1fhsF9oenG3JbboPtIAPhU52XdxLrf8o4a6i7SDkgp1EtPE+z9vMgVmQxxd7JNqhwbtfaQIDAQABo4GbMIGYMB0GA1UdDgQWBBR6ZBYnkNbj5rOQEUSVZEzzCXfQPTBpBgNVHSMEYjBggBR6ZBYnkNbj5rOQEUSVZEzzCXfQPaE9pDswOTE3MDUGA1UEAxMubW9jay1zYW1sLWlkcCxkYz1zZXJ2aWNlcyxkYz12YW1mLGRjPXZhLGRjPWdvdoIJAO5DUXArAG/VMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAG89Yf3u4gepc19A5rwYxvjrmdhrqptETDhczLveAeoY0bdl/GQzw8L+QiNhAbH35wfelOD/rzIC+D1ScFzYQqtA0Ov0VPdztV11CmUyangYexySn7Il/Fv4AGIMmmVO8T7VD0giP0lwO7g3WrD1xm11QEORSODoCJygoFjlf2OpP82zDf+EpNo8Rr9Y8s+oDiS29bRE0t6ODSxUtLWOoQ+fgFH5jKe1k00xOytPdaNlUd8/rZpkiZosu5rU7IZ/Eqpmr2CBBk6BQcSTk5Qf01Sfo0b/7ssoaIrYZK6yH5E3PKhS+18ruVEvNkcXrJfGS6F/yW4QXjba8kYmZJYLQ9E="
    - "STS_SP_PRIVATEKEY=MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDAdui0SAQRgV4rwhxG980fyvVjViYsF9qi7Qa8xiM83G1Z8wam1nYm6Vl7TQHhKpz1szh8fYK9MRt5/waQYb7KiDCrKzgk3KXOI/CGsQ2w6ke+4MFR5w1RdtnHxGOzKqiv4jbCQSG9AhOilntsYViZAUCte7BdxtzMhHgw6FIVio+xoEDygoCRW1uMiouoK+X96Qt4lJXcQKRcoTrmiSY4Cfb0AO8KqgyMwEy1Bi6GomBqnUxpehBkZZtOXroI0gFXVLa0/C352OnOBdOeUobvjJlou34edgwBDWIFZsWKIEdi1Rbvgi527oVrDgdrLFzr95qfMK2leGI5KluHznVjAgMBAAECggEBAKKExkNVfHn7r7Vrl80leoSaMVPMbzdUfT6Ov92vwhmmWIBYAwnmlqaM7Q59HFUyUo/24n/czAVN7lG506UfpKgJEG+5cxNNboT/PB/Aajs12ZeI2jV60Xg0z/ksELQ+FWtPrcWikga0NjhYsaf3G4U31ZGonGjTf6cDRSqnQokEnPRGUfDXS3tYShb94R/7/o9/0M1+eQZgKKSWhjWiix7Wt3SGD8ypyWJbG8GBlVeQYiBcfupRVBRyEz9Cul4kl9FpK0VGkkelP41FXpZVQDb7t0gr/lCrunb1uq1y2e2wBUYcuoL8psyTy3HuQJtj1dmUhHgh8lO8dE+0FDyosWECgYEA5Y0anocpHKsmm4xo3KWGq5M9v/0dVnRnTxQMb5Z4GPVmDI7Tm40wK5Ts2YiwJRR/Qr7uOYu1efxTnKwdY8V1VTtciOl8J4kiV4H4O/+MRY5RpI28p5Iy4EbEriqwf1YuhZsgfGVkW7s3Fbh25OvP7/SiV62Dw8C/Xf++HvY5oJ8CgYEA1qPjEYBh3QzE3pJ1sLj6BPFr2Ayv244ldliqNWmsIOxnc/4ySJ2lmAHHW24S6RPQuqwBO+BNQ5NJAgOJ/mvtWCqxo6cc9Ti0UVZMyIut5IIX5llXvMAjOABzEZRyLuK44Y9L8X17dm4/Zu/1qK3u2+PM8/w/mbCyGIpuPDtxIL0CgYEAw0yPzzxTYA7FZCXLuZ4iu6skKEnjQgD7PC5kfjPYrfNrBVgm9Prkds/XyyQeKQ4NT+49pDwXBFgHkw5kWtROhVth2SI8/S4RR75OQk2jPDJfh88HKNKb8nCDOWMcktnx7r4Sn4NsJRddQF+W2CFA4niR/mKj7lH4/rJtQM5gLSUCgYBj8+fPA6EPJl4bY8rIpCtR1/cnoijWrmhFp16EBxSwNEas3mgeJsOxeMqUijrmLWMbOvRMJNT2LgVmma1OPIZHc4JLuouiqmhWJEEXduxgqDBnBZ30+OitsI/lVOKjcNM1vtxXtd6jtQ1zazVT+sNrxLZxvDsF4CHfib9x7yBsZQKBgAhfBhxrz8SI04l5b7ovBwscEIqjwB3b74sOnAa/TtulMZlcqizs4klSs7gsjziAGK7L9GQh0xd8h+RKmEGHsk3ApR5oVHzPrSQgNwQcyRTPW2D9sDArxlTzY6I/1lhTKqHgACUMx+ScZDt0enhB+ytiizpdJZ8Q8p8s29e0hJfu"
    - "STS_IDP_CERTIFICATE=MIIDfzCCAmegAwIBAgIJAM4Yygnd0gYnMA0GCSqGSIb3DQEBBQUAMDMxMTAvBgNVBAMTKHNhbWwtc3AsZGM9c2VydmljZXMsZGM9dmFtZixkYz12YSxkYz1nb3YwHhcNMTcwNzIxMTgwOTM0WhcNMzcwNzIxMTgwOTM0WjAzMTEwLwYDVQQDEyhzYW1sLXNwLGRjPXNlcnZpY2VzLGRjPXZhbWYsZGM9dmEsZGM9Z292MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArxQm4THouUwpUKV1Ip6ORia5dPzkqxzhTWRyRJM8YPfT+1NO/Aeu084vXIkC1jpw/z21KqXazqTiKx4sinp5hr/cR9EiRS/GixRxqH4pUbvPd9LlguOebq5Y00JQm3l58EDdzo7BhHCsc+Of2ELSwlRU+HtDbYCJlFidYJ/DowvrB9W6dwL+vyLNl2TmbNHjOlOmPIgWwCtPFExcL35n9JhYV9OJ+UWk2SjyZRVbDZ2bWlGOrBFhnpPyuiFmXX6X5bMp1ftt1o4OaIDlOngNg7yzdVt4BiWX8xWpd6P8UpM730kuba9r5x4P1Zd43BhjDGz1uKMlssAPkIms+9zA6wIDAQABo4GVMIGSMB0GA1UdDgQWBBSHbr+gp9DDO1Qm1w/uw8JZU/zYbDBjBgNVHSMEXDBagBSHbr+gp9DDO1Qm1w/uw8JZU/zYbKE3pDUwMzExMC8GA1UEAxMoc2FtbC1zcCxkYz1zZXJ2aWNlcyxkYz12YW1mLGRjPXZhLGRjPWdvdoIJAM4Yygnd0gYnMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAI3D++AS0ChQP++vTxIyKuUO/Y9zqbteZ0I1qDJE1QmI7g9GZ0WGYwKK+3DxUfACI3WAokkB9Yk7ar/LkQZGPnXAv1SaRAsv71VvE1fz95WnsoXQ766TxIl9J5Qg8kZSVHxLEbSCAdIwz3wz4+KPpdyj3NN30LYiPHpf51Qw9+hGN1rTBIQbsCs4/7EfLUt9iUFNBREXM5NyofiB50c8PsUG0i3yO+/83xm+AAPWrOzZh3Fcc0OsCWI84TrhqP/zU6lwg7u7JTdzmd7+z2I6YG32Mnxkwd1bZ8wOQyl4RfpqLC9A9FqqjM47zWwaj6O4ywpoz1Mb1z1SQjG4TRxQWRg="
    #- "STS_IDP_CERTIFICATE=MIIDkTCCAnmgAwIBAgIJAO5DUXArAG/VMA0GCSqGSIb3DQEBBQUAMDkxNzA1BgNVBAMTLm1vY2stc2FtbC1pZHAsZGM9c2VydmljZXMsZGM9dmFtZixkYz12YSxkYz1nb3YwHhcNMTcwNjMwMDExNDA3WhcNMzcwNjMwMDExNDA3WjA5MTcwNQYDVQQDEy5tb2NrLXNhbWwtaWRwLGRjPXNlcnZpY2VzLGRjPXZhbWYsZGM9dmEsZGM9Z292MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsyEeemzH9sVeyaXziWaXRw1pG7uLkr/pT4NBfNF/Ejcsj/Kbvbi7WK4i1g2w/3R9CdVPCFtHBMpcI2uN5Z5blSqwBulJ9BMF/HAp7ImYQhMuZLzgy7iA7z1rdLzzmqvVTPeGm1SjNuc0J2fe/+s/HhJJ+Xo5+v4EeZNegDzyEVpHc9PQzQjmLzPnjNsAWVy/jBmwQPoV3VcGDWkccaxVwcS6OS/oGTxs1Ax4dKvfGqf+/IuVFyBrWniLLdiwtupROBvxK8X6D+GyLY0o1fhsF9oenG3JbboPtIAPhU52XdxLrf8o4a6i7SDkgp1EtPE+z9vMgVmQxxd7JNqhwbtfaQIDAQABo4GbMIGYMB0GA1UdDgQWBBR6ZBYnkNbj5rOQEUSVZEzzCXfQPTBpBgNVHSMEYjBggBR6ZBYnkNbj5rOQEUSVZEzzCXfQPaE9pDswOTE3MDUGA1UEAxMubW9jay1zYW1sLWlkcCxkYz1zZXJ2aWNlcyxkYz12YW1mLGRjPXZhLGRjPWdvdoIJAO5DUXArAG/VMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAG89Yf3u4gepc19A5rwYxvjrmdhrqptETDhczLveAeoY0bdl/GQzw8L+QiNhAbH35wfelOD/rzIC+D1ScFzYQqtA0Ov0VPdztV11CmUyangYexySn7Il/Fv4AGIMmmVO8T7VD0giP0lwO7g3WrD1xm11QEORSODoCJygoFjlf2OpP82zDf+EpNo8Rr9Y8s+oDiS29bRE0t6ODSxUtLWOoQ+fgFH5jKe1k00xOytPdaNlUd8/rZpkiZosu5rU7IZ/Eqpmr2CBBk6BQcSTk5Qf01Sfo0b/7ssoaIrYZK6yH5E3PKhS+18ruVEvNkcXrJfGS6F/yW4QXjba8kYmZJYLQ9E="
    - "STS_IDP_METADATA=<?xml version=\"1.0\" encoding=\"UTF-8\"?><md:EntityDescriptor xmlns:md=\"urn:oasis:names:tc:SAML:2.0:metadata\" ID=\"_d5c54ccd-e3fe-4d79-ae50-dea945902fc7\" entityID=\"http://mock-idp\" validUntil=\"2017-07-19T22:15:27.389Z\"><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><ds:Reference URI=\"#_d5c54ccd-e3fe-4d79-ae50-dea945902fc7\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><ds:DigestValue/></ds:Reference></ds:SignedInfo><ds:SignatureValue/></ds:Signature><md:IDPSSODescriptor protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\"><md:KeyDescriptor use=\"signing\"><ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><ds:X509Data><ds:X509Certificate>MIIDkTCCAnmgAwIBAgIJAO5DUXArAG/VMA0GCSqGSIb3DQEBBQUAMDkxNzA1BgNVBAMTLm1vY2stc2FtbC1pZHAsZGM9c2VydmljZXMsZGM9dmFtZixkYz12YSxkYz1nb3YwHhcNMTcwNjMwMDExNDA3WhcNMzcwNjMwMDExNDA3WjA5MTcwNQYDVQQDEy5tb2NrLXNhbWwtaWRwLGRjPXNlcnZpY2VzLGRjPXZhbWYsZGM9dmEsZGM9Z292MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsyEeemzH9sVeyaXziWaXRw1pG7uLkr/pT4NBfNF/Ejcsj/Kbvbi7WK4i1g2w/3R9CdVPCFtHBMpcI2uN5Z5blSqwBulJ9BMF/HAp7ImYQhMuZLzgy7iA7z1rdLzzmqvVTPeGm1SjNuc0J2fe/+s/HhJJ+Xo5+v4EeZNegDzyEVpHc9PQzQjmLzPnjNsAWVy/jBmwQPoV3VcGDWkccaxVwcS6OS/oGTxs1Ax4dKvfGqf+/IuVFyBrWniLLdiwtupROBvxK8X6D+GyLY0o1fhsF9oenG3JbboPtIAPhU52XdxLrf8o4a6i7SDkgp1EtPE+z9vMgVmQxxd7JNqhwbtfaQIDAQABo4GbMIGYMB0GA1UdDgQWBBR6ZBYnkNbj5rOQEUSVZEzzCXfQPTBpBgNVHSMEYjBggBR6ZBYnkNbj5rOQEUSVZEzzCXfQPaE9pDswOTE3MDUGA1UEAxMubW9jay1zYW1sLWlkcCxkYz1zZXJ2aWNlcyxkYz12YW1mLGRjPXZhLGRjPWdvdoIJAO5DUXArAG/VMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADggEBAG89Yf3u4gepc19A5rwYxvjrmdhrqptETDhczLveAeoY0bdl/GQzw8L+QiNhAbH35wfelOD/rzIC+D1ScFzYQqtA0Ov0VPdztV11CmUyangYexySn7Il/Fv4AGIMmmVO8T7VD0giP0lwO7g3WrD1xm11QEORSODoCJygoFjlf2OpP82zDf+EpNo8Rr9Y8s+oDiS29bRE0t6ODSxUtLWOoQ+fgFH5jKe1k00xOytPdaNlUd8/rZpkiZosu5rU7IZ/Eqpmr2CBBk6BQcSTk5Qf01Sfo0b/7ssoaIrYZK6yH5E3PKhS+18ruVEvNkcXrJfGS6F/yW4QXjba8kYmZJYLQ9E=</ds:X509Certificate></ds:X509Data></ds:KeyInfo></md:KeyDescriptor><md:NameIDFormat>urn:oasis:names:tc:SAML:2.0:nameid-format:persistent</md:NameIDFormat><md:SingleSignOnService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\" Location=\"http://ec2-54-152-177-13.compute-1.amazonaws.com:8900/SingleSignOnService\"/></md:IDPSSODescriptor></md:EntityDescriptor>"
    #- "STS_IDP_METADATA=<?xml version=\"1.0\" encoding=\"UTF-8\"?> <md:EntityDescriptor entityID=\"MHV-IDP\" xmlns:md=\"urn:oasis:names:tc:SAML:2.0:metadata\"> <md:IDPSSODescriptor ID=\"MHV-IDP\" WantAuthnRequestsSigned=\"false\" protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\"> <md:KeyDescriptor use=\"signing\"> <ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"> <ds:X509Data> <ds:X509Certificate>MIIDTTCCAjUCBgFdPEKDVDANBgkqhkiG9w0BAQUFADBqMRAwDgYDVQQDDAdNSFYtSURQMRAwDgYD VQQLDAdWQSBPSSZUMRYwFAYDVQQKDA1NeSBIZWFsdGhlVmV0MRIwEAYDVQQHDAlDdWxwZXBwZXIx CzAJBgNVBAgMAlZBMQswCQYDVQQGEwJVUzAeFw0xNzA3MTMxNDAyNThaFw00NDExMjcxNDAyNTha MGoxEDAOBgNVBAMMB01IVi1JRFAxEDAOBgNVBAsMB1ZBIE9JJlQxFjAUBgNVBAoMDU15IEhlYWx0 aGVWZXQxEjAQBgNVBAcMCUN1bHBlcHBlcjELMAkGA1UECAwCVkExCzAJBgNVBAYTAlVTMIIBIjAN BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmZFlH0zhpZKWeoSNqn8mNgNqiBCIz4JCMknhVypL pBnCDsVxlWr8fKSHcVKLJJXZmwJxPbNFLZBWo5EeaYbIOzL/nt4pWCx9J4AtMjvBRl2Fx4BBAr6q IBSI8toXzDuSvSznVHRQdXive2mL23eCG4QQocW0EboC8lESMZJ/sKJDVT+WUUiYyVp+dXl1Gphp iY5VZn6CkHki4llwwJKu69VWg6S2SeT5cQbjs+ylowEaqzL0Sic4Yv9+7RIo0VCs8exoqLUMs5mt 2CarCmQiqVJFfNTQke4c7uy9EqfI+PwSd4iG8WWnV2TiZ5JVXG/vY7NAyNKTW+dPttDv+rtZjwID AQABMA0GCSqGSIb3DQEBBQUAA4IBAQB8/XItSImeOi5ofbtK0s4ClzxlI+f/QstGgxwttKKDAZOS k1QyXK5BAsBLcxX8vMsiEVctzQ2ouwqggJB+0XV4LA3pnsOAhDt1tN7OpV+TmvvldR4ipxhn/4br XZrI0vZnLTjsr/XQpmRkubFe6A8wdXFctweTw1xGgGCrNQxwgQhgus7Z7o1V8hbtcTucx3hvHUH6 ILm7psfMdtnKQTRnKN7SNxkxOgYREdS8tnP07nv8LsSz3cwD/mV7cicVx2AIXllnpAOJHFgKla/b OuY1pdRl+JJz+1P6P8eMGTtzSnEOSg/tV0BVI/xq/oPx2tv+8EXnghBbWDs6BWAiZzJE </ds:X509Certificate> </ds:X509Data> </ds:KeyInfo> </md:KeyDescriptor> <md:SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"https://mhv-intb.myhealth.va.gov/mhv-portal-web/c/portal/saml/slo\" /> <md:SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\" Location=\"https://mhv-intb.myhealth.va.gov/mhv-portal-web/c/portal/saml/slo\" /> <md:SingleSignOnService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\" Location=\"https://mhv-intb.myhealth.va.gov/mhv-portal-web/c/portal/saml/sso\" /> <md:SingleSignOnService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"https://mhv-intb.myhealth.va.gov/mhv-portal-web/c/portal/saml/sso\" /> </md:IDPSSODescriptor> </md:EntityDescriptor>"
    - STS_IDP_METADATAURL=http://mock-saml-idp:8080/metadata
    - USERSVC_URL=http://ec2-54-152-177-13.compute-1.amazonaws.com:8081
    - "STS_JWT_PRIVATE_KEY=MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDXuKCxcZ+mDcFG/V2v2MDKHKMZSkNJDUIIiNAj81kP46jGhOW88yZjzJDc5+KyekTvNH500B2PsIcKIJsqBAqM+Y7N2hsokPs3znfyXFnbCUc2SjSsbeLIIolVEkUxeKtl+s8RGUWPQBCvCGhsim7DIVB+w1Nk9rF5o3fkF7Gjt+jC7QsGTO8KKhl8qrpA/HHypDT/AljF6HcPhvk1ZHV4htakkTk1tZjHRlKz9MPkdBMAawi8k3n4QrNUHVFkCnRTB3ENATsGOlcFfHQ+NmJ0JjaQfaNWbU4d3/HORmIi3YRh7kKl38K4t9aPPEe/qkKQLwjRrqqWNA1L2I5BzpuXAgMBAAECggEAJkZP3Kv4U5IlNN9HfCfNLQ8fsSEIBzIfATylEXvf1X3jODXkPT43FYX6Pfe2tUwUZwy9UySJ2jDMBPP8E9xbst+kgsmr/+qZaDFt/sZ7+u0OgYdxCRcGIdRe4YU4Waq7XoC9tJ7zRJNtYmDvhjKZrG2Axr0JUuSiYJ6sav/5OL7ZXWC6ZCvakH6LuR5Pi4CmYbrzUR98KbPmTDqbFtcFce4/i4Y3syJv7mmGdNA4JsM4rElweHo801mBbXRMOBzMQn+U5YOCmjlzGIw3pS6RQsQ1Vnq44zuM3DX4xX1Q4h4Zkce0L6yEH3+SApRb8IVc10dlwUYZ/ERdyfa/q6u/QQKBgQDrWrU4cEDvF+y+oL3tGq+whOBbBlX3Gu/ggDvhmIARkcnidov1SgmQOeOMmukfToq6wD4NilPkAH++H1yT70mf4NpwvoRwkGlxVVIWiGIBdGeybLXVQEZS7sGB9v0LJ3JeWCByreIBxExgVS7BgfoPSKVvtpBuDbAEpE/2NaRL3wKBgQDqpQYSaYaGDxmYr9k8mQrBM0L95ktlQJbWfakoqlHCMjcQrFpDc1SbbFR9Crhm4Cmks1Dk9k5DgXD0LBWvLke8EWXQunGxPGXIfsbwN3+FKeTo0zOFNxQLqDtMzbrNFmNn6Yt1GeFQUk1Pm5MmJQB76uPAiyNFuk7MXio9/lonSQKBgEyupEb8RBvitq8xnlAnlsCzuonN2aqGa0vBXEFXt7qBvr57k4RbGByWz+4a9wPNSmQoiM9Ol6C9DOH8Q+SrXVirIWEEohAu7TwQ6YsP6qbAr5yx0NjndUJGKmRW/gFpW9kja4cR4oZi1+O3PWGtILVkHQr1977z1LrecnMs7RgPAoGBAMw/X5yxXJbfGAHPuEJGWZU5IOxQBXsakPIeKhwqvcZT3ZjW3i9uecxcrOK3bTKnl7g1GopjWFbsmr0AjtORboHnhv/8+zAzCcpPiK3bMVZh1E9SYLtp6ToIc630OtGA1oDCS1FgeL9pFMDiBGGkvdof6aZVtxtgBG1i3lReTm15AoGAIi1PFZ+O3lgf6jmh1XKDcAT3H8KlHudcIYHTi/cQnNSkO03Fy9oYxak/oLe+eudVUoJxvxLQJoY4pB3PHiAsoTc96exjGzJkrNE2Ah6XcAQdsya0PFqCY19lwjz3t4tujn4PcInkULUyd/XhgG1ZtttDPEbcltthZ7pFfND25n0="
    - SERVICE_TAGS=local
    - SERVICE_8080_NAME=saml-sts
    - CONSUL_SERVER=consul:8500
    - CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
    - CONSUL_PATH=appconfig/local/sts
    - VAMF_ENVIRONMENT=local
    depends_on:
    - mock-saml-idp
    links:
    - mock-saml-idp

  # Mongo mock for quartz and notifications, username/pass authentication turned on by default
  # SSL turned off by default
  mongo:
    image: dtr.mapsandbox.net/mock-mongo:1.0.0
    expose:
      - "27017"
    ports:
      - "27017"
    environment:
      - MONGODB_ADMIN_USER=admin
      - MONGODB_ADMIN_PASS=adminpass
      - MONGODB_APPLICATION_DATABASE=notificationsdb, remindersdb, taskresourcesdb
      - MONGODB_APPLICATION_USER=testuser
      - MONGODB_APPLICATION_PASS=testpass
      - SSL_ENABLED=false
      - AUTH_ENABLED=true
      - JOURNALING=true

  #Quartz Scheduler
  vamf-quartz-scheduler:
    image: dtr.mapsandbox.net/quartz-scheduler:latest
    ports:
      - "8097:8080"
    environment:
      - "VAMF_ENVIRONMENT=local"
      # Use Vault
      - VAULT_ADDR=http://vault:8200
      - SECRET_PATH=secret/local/quartz-scheduler
      # Use consul
      - USE_ENVCONSUL=true
      - "CONSUL_SERVER=consul:8500"
      - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
      - "CONSUL_PATH=appconfig/local/quartz-scheduler"
      #- "MONGO_NOTIFICATIONS_URI=mongodb://mongo:27017/notificationsdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
      - "MONGO_NOTIFICATIONS_URI=mongodb://testuser:testpass@mongo:27017/notificationsdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
      - "SMTP_HOST=mock-smtp-server"
      - "SMTP_PORT=3465"
      - "SMTP_SENDER=mailsender@localhost.com"
      - "SMTP_USERNAME=mailsender@localhost.com"
      - "SMTP_PASSWORD=password"
      - "SMTP_AUTH=false"
      - "SMTP_CONNECTIONTIMEOUT=10000"
      - "SMTP_TIMEOUT=10000"
      - "SMTP_STARTTLS_ENABLED=true"
      - "SMTP_SSL_TRUST=*"
      - "ORACLEDB_URL=jdbc:oracle:thin:@qss-mock:1521:xe"
    #- "ORACLEDB_USER=HADB" #set in vault
    #- "ORACLEDB_PASSWORD=m0ckpass01" #set in vault
    depends_on:
      - mongo
      - qss-mock
      - vault
    links:
      - mongo
      - qss-mock
      - vault
      - mock-smtp-server

  # QSS Mock
  qss-mock:
    image: dtr.mapsandbox.net/md/map/docker-roa-mock:1.0.3
    #image: roa-mock-test
    ports:
      - 1521

  #VAMF Notification Services
  vamf-notification-services:
    image: dtr.mapsandbox.net/images/notification-service:1.6.3
    ports:
      - "8100:8080"
    environment:
      - "VAMF_ENVIRONMENT=local"
      # No Secrets don't Use Vault
      #- VAULT_ADDR=http://vault:8200
      #- SECRET_PATH=secret/local/pns
      # Use consul
      - USE_ENVCONSUL=true
      - "CONSUL_SERVER=consul:8500"
      - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
      - "CONSUL_PATH=appconfig/local/pns"
      - "JAVA_OPTS=-Xms256m -Xmx512m -XX:-TieredCompilation -Xss256k -XX:+UseG1GC -XX:+UseStringDeduplication"
      - "QSS_BASE_URL=http://vamf-quartz-scheduler:8080/qss/v1"
      # Uncomment if running the mongo mock without authentication
      #- "MONGO_NOTIFICATIONS_URI=mongodb://mongo:27017/notificationsdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
      #- "MONGO_REMINDERS_URI=mongodb://mongo:27017/remindersdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
      - "MONGO_NOTIFICATIONS_URI=mongodb://testuser:testpass@mongo:27017/notificationsdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
      - "MONGO_REMINDERS_URI=mongodb://testuser:testpass@mongo:27017/remindersdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
      - SERVICE_TAGS=local
      - SERVICE_NAME=vamf-notification-services
    depends_on:
      - mongo
      - vamf-quartz-scheduler
    links:
      - mongo
      - vamf-quartz-scheduler
      - vault
      - mock-smtp-server
    restart: on-failure

  # Task Resources
  task-resources:
    image: dtr.mapsandbox.net/ckm/task-resources:1.0.4
    ports:
      - 8099:8080
    environment:
      - "VAMF_ENVIRONMENT=local"
      # No Secrets don't Use Vault
      #- VAULT_ADDR=http://vault:8200
      #- SECRET_PATH=secret/local/pns
      # Use consul
      - "USE_ENVCONSUL=true"
      - "CONSUL_SERVER=consul:8500"
      - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
      - "CONSUL_PATH=appconfig/local/task-resources"
      - "MONGODB_TASK_RESOURCES_COLLECTION=taskresources"
      - "MONGODB_TASK_RESOURCES_DB=taskresourcesdb"
      - "MONGODB_TASK_RESOURCES_URI=mongodb://testuser:testpass@mongo:27017/taskresourcesdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
      - "SERVICE_NAME=task-resources"
    depends_on:
    - mongo
    links:
    - mongo

  #vault server for managing secrets
  vault:
    image: dtr.mapsandbox.net/ckm/vault-server:latest
    environment:
      - VAULT_LOCAL_CONFIG={"storage":{"consul":{"address":"http://consul:8500", "token":"7BE784A4-7498-4469-BE2F-9C3B9444DFEF", "path":"vault", "scheme":"http"}}}
    ports:
      - 8202:8200
    links:
      - consul

  # redis for container state
  tredis:
    image: dtr.mapsandbox.net/vamf-redis:1.0.0

  # Mock SMTP server for use with PNS and QSS
  mock-smtp-server:
    image: dtr.mapsandbox.net/mock-smtp-server:1.0.0
    expose:
      - 3025
      - 3465
      - 3110
      - 3995
      - 3143
      - 3993

  # End User License Agreement (EULA) Service v1
  eula-services_v1:
    image: dtr.mapsandbox.net/ckm/eula-service:1.3.0
    expose:
      - 8080
    ports:
      - 8098:8080
    environment:
      - VAMF_ENVIRONMENT=local
      # No Secrets don't Use Vault
      #- VAULT_ADDR=http://vault:8200
      #- SECRET_PATH=secret/local/eula
      # Use consul
      - USE_ENVCONSUL=false
      - CONSUL_SERVER=consul:8500
      - CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
      - CONSUL_PATH=appconfig/local/eula
      - ORACLE_USERNAME=HADB
      - ORACLE_PASSWORD=m0ckpass01
      - ORACLE_URL=jdbc:oracle:thin:@//mock-roa:1521/xe
      - JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB
      - EULA_LATEST_VERSION=1
      - JWT_SECRET=testtesttest
      - ENABLE_ZIPKIN=false
      - SERVICE_TAGS=local
      - SERVICE_NAME=eula-services_v1
    links:
      - mock-roa

  # Config Service for web apps to interact with consul
  config-service_v1:
    image: dtr.mapsandbox.net/config-service:1.0.0
    ports:
      - 8181:8080
    environment:
      - CONSUL_URL=http://consul:8500
      - CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
      - "KEY_PREFIX=/vamf/local/env-settings/1.0/"
      - JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB

  # IAM SSOe Mock - Injects HTTP headers to simulate SSOe token header injection. Allows log in/out.
  iamssoe-proxy-mock:
    image: dtr.mapsandbox.net/images/idp-mock/iamssoe-proxy-mock:1.1.0
    #image: local-idp
    ports:
      - 9000:80
    environment:
      - DB_HOST=iamssoe-db-mock
      - DB_PASSWORD=MySqlAdmin$$
      - API_GATEWAY_URL=http://apigateway
      - "CLIENT_LANDING=/users/v1/landing?redirect_uri="
    volumes:
      - /tmp/ssoenothing:/usr/local/openresty/nginx/conf/secured

  iamssoe-db-mock:
    image: dtr.mapsandbox.net/images/idp-mock/iamssoe-db-mock:1.1.0
    environment:
      - MYSQL_ROOT_PASSWORD=MySqlAdmin$$
      - MYSQL_DATABASE=MockUser

  # Mock SSOi
  ssoi-mock:
    image: dtr.mapsandbox.net/images/ssoi-mock:2.0.0
    ports:
      - 9001:80
    environment:
      - API_GATEWAY_URL=http://apigateway
      - PROTECTED_PATTERNS=/jwt,/dementiacareprovider,/paincoachprovider,/gdxprovider/,/mentalhealthcheckupprovider/,/PatientSearchService,/skin%-check,/ClinicalEventService,/SkinCheckServices,/annie-provider-beta/,/ivs/,/immCampaign/v2/,/patient-viewer/v4/,/schedulingmgr/v2/,/users/v1/landing
      - "USERS={\"users\": [
          {\"userId\": \"vhastaff01\", \"headers\": {
            \"ADDOMAIN\": \"vha\", \"ADEMAIL\": \"test01.Staff01@va.gov\", \"LASTNAME\": \"Staff01\", \"FIRSTNAME\": \"Test01\",
            \"SESSIONSCOPE\": \"B\", \"VAUID\": \"1984\", \"ADSAMACCOUNTNAME\": \"staff01t\", \"ACCESSROLES\": \"CBSS_Access\",
            \"DODEDIPNID\": \"1020002350\", \"VISTAID\": \"508|22228439^PN^508^USVHA|A,590|11128439^PN^590^USVHA|A\", \"SECID\": \"0000028347\",
            \"MVIICN\": \"1008693670V746966\", \"VISTAIDRAW\": \"508|22228439^PN^508^USVHA|A^590|11128439^PN^590^USVHA|A\",
            \"ORGANIZATIONID\": \"urn:oid:2.16.840.1.113883.4.349\", \"ASSURLEVEL\": \"2\", \"ORGANIZATION\": \"Department of Veterans Affairs\",
            \"PROOFINGAUTH\": \"VA\", \"ROLE\": \"role1\", \"ISSUEINSTANT\": \"2017-06-19T13:37:16Z\", \"AUTHNTYPE\": \"Direct\",
            \"ADUPN\": \"tstaff01@iam.va.local\", \"TRANSACTIONID\": \"00000000000000000000000036d0e30a-0ad4-5947d38c-3688-00fa4fca\",
            \"SSOI_LANDING_URL\": \"http://not_set\",
            \"SSOI_LOGGEDOUT_URL\": \"http://not_set\",
            \"IAMSESSION\": \"test\"
          } },
          {\"userId\": \"vhastaff06\", \"headers\": {
            \"ADDOMAIN\": \"vha\", \"ADEMAIL\": \"test01.Staff01@va.gov\", \"LASTNAME\": \"Staff01\", \"FIRSTNAME\": \"Test01\",
            \"SESSIONSCOPE\": \"B\", \"VAUID\": \"1984\", \"ADSAMACCOUNTNAME\": \"staff01t\", \"ACCESSROLES\": \"CBSS_Access\",
            \"DODEDIPNID\": \"1020002350\", \"VISTAID\": \"516|22228439^PN^508^USVHA|A,590|11128439^PN^590^USVHA|A\", \"SECID\": \"0000028347\",
            \"MVIICN\": \"1008693670V746966\", \"VISTAIDRAW\": \"516|22228439^PN^508^USVHA|A^590|11128439^PN^590^USVHA|A\",
            \"ORGANIZATIONID\": \"urn:oid:2.16.840.1.113883.4.349\", \"ASSURLEVEL\": \"2\", \"ORGANIZATION\": \"Department of Veterans Affairs\",
            \"PROOFINGAUTH\": \"VA\", \"ROLE\": \"role1\", \"ISSUEINSTANT\": \"2017-06-19T13:37:16Z\", \"AUTHNTYPE\": \"Direct\",
            \"ADUPN\": \"tstaff01@iam.va.local\", \"TRANSACTIONID\": \"00000000000000000000000036d0e30a-0ad4-5947d38c-3688-00fa4fca\",
            \"SSOI_LANDING_URL\": \"http://not_set\",
            \"SSOI_LOGGEDOUT_URL\": \"http://not_set\",
            \"IAMSESSION\": \"test\"
          } },
          {\"userId\": \"vhastaff02\", \"headers\": {
            \"LASTNAME\": \"Staff02\", \"FIRSTNAME\": \"Test02\",
            \"ADUPN\": \"tstaff01@iam.va.local\",
            \"VISTAID\": \"590|10300252^PN^590^USVHA|A,500|12744^PN^500^USVHA|A\"
          } }
          ] }"

  #Patient context service
  patient-context:
    image: dtr.mapsandbox.net/md/map/patient-context:latest
    container_name: patient-context
    ports:
      - '3001:3001'
    links:
      - var-mongo-db-mock
    environment:
      - "constraint:nodetype==*service*"
      - "CONSUL_SERVER=consul:8500"
      - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
      - "CONSUL_PATH=appconfig/local/patient-context"
      - SERVICE_TAGS=${VAMF_ENVIRONMENT}
      - SERVICE_NAME=patient-context
      - JWT_PRIVATE_KEY=MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDBGzt361EC4riygMie4qnnWVNNNdY3yiRdHf+BIeIgH6ru9l4AZYDxQuMJi4QIt17y1Lo7HNnBKP+gzSRkFe4cpira6RYqNMSY7CWlBbi8GlfrRtzHmtfCgSNtxaCEr2hVbBjg7BsAnhNiSWRQdkLlu5D7xFTn27oUhZK/Y3cP1UGR9iwe+nc7hpdVoTx1nR3GV1R2/9Z4+guQJ5RiAuwbIOD/Oxm8OtfX7K82yM02YH+SwlKim0y/0J/JSlJex+i/7waEEK2DMO+CffaTDv3A+ytOSCcLQNG26/7LeoJdf5knpxsnfW1W6z0Bp1SfYKtYm6vr8pFiyeJBoSd8DjeHAgMBAAECggEATcnKiuQgHil2fXGjX12vU6KIC/JD+PVU8K3E3x/nF0mqcdiMxVweNRHco1uwNFKpzOgknOtiTI1XbE82+Zpb8O5/FPAQHbBkAbYe8/r6D8wM3poNFdsqTw/2VaHmp4yBWufQncp+liEXbeBiqIb7K9AC92h/S2cX7mxgUPigXZ+2V5Bvdjo2jAtdrq6nXFtzsqCxNKFpFifdV2TkFbq6vGB/mJdrFHspUiMZc2KAR7/pQCO/oR/WIyHRTBvWcM/zrd/7A6TZRKYMabYDn1dbyP/ATqyJ/rtx+7Josj+LogBVrdeD7USpdHj6FLbT/Z0N5o1tintUlj8eo1XqNupjAQKBgQD2VLTgiVphbju0YA65I1yWYuPYdDXJVkJjqv7lFndPdOGZsfysdc2fdkdAEkPVZhI5Tve8CvOW98WnVLkj/WRyfBVeVbekIGdsH/PWRTrLv5mXbpDGYP0z1c7FTMx6qiaE6ZLZATy4jWBLRPQcJj5rm70nO4Sajfo5TQW4BB+abQKBgQDIr7Dvq5AixiMSzbvhPIDqjIYQv+TCbzKoNm/JuRgE/1mxfgxuthNA8OLDBEmCa3SWUo9Slrq5KnynVMnxIMiTw9CSbLhUYxqlrP0ei6C7d1bv5N3tH4GD5ljCmobz04Dg56/bs/pbfJBjfE2qxtrEgzK51FazUzlFUwzf++vhQwKBgQCCUuRzWxfvLjP2RU/k0XmdsuoazbjbMYDkXEaJC27KIetttkYZNCY6tIgTtNYgo+UGXuogmaawe5wd4GwnR1uKWm2vwCftdJtjEDCgb3Yg79ihzoRYAF5Vu0uvBOe2Cilg7nabytTGSz3j9LI15mHl6rqTdCC+6Fi3UjGxXrUdrQKBgQCjPF0EJZ2A239N3TA0Hd2Saqjl2OA+0un2bwjwoPCLqBQRzkBYkRsKGKWqEMOmJLdZSmAvwlCxKoDoLoxv6MWdg4oUgABTC6VyG0pr3RDpS0HYsWVeaeEUI3oRGFYq39+VkH63iyZZ4fEkKsiV31e0vi61fqTjCg+sdsgjLCuKNwKBgQDhp8wfpcqYnvDvn7OKL52SiXfktTWe8xq6pVKLDrHScEUhj/vgcXkvOiELP+jnNivMU2AWObLq0Nf+JWpH4HrIH8R+Ag7sgy+mL53Ku+4I2et1JsHCc94AS59qY/C4AqZDgpFAFYKTNPRn+bQMAIRCh2dIayehKTgZpvhmxxSSvw==
      - JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB
      - "JWTISSUER_CONFIG_JSON=[{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"gov.va.mhv.idp.v1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"external.idp.test1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA17igsXGfpg3BRv1dr9jAyhyjGUpDSQ1CCIjQI/NZD+OoxoTlvPMmY8yQ3OfisnpE7zR+dNAdj7CHCiCbKgQKjPmOzdobKJD7N8538lxZ2wlHNko0rG3iyCKJVRJFMXirZfrPERlFj0AQrwhobIpuwyFQfsNTZPaxeaN35Bexo7fowu0LBkzvCioZfKq6QPxx8qQ0/wJYxeh3D4b5NWR1eIbWpJE5NbWYx0ZSs/TD5HQTAGsIvJN5+EKzVB1RZAp0UwdxDQE7BjpXBXx0PjZidCY2kH2jVm1OHd/xzkZiIt2EYe5Cpd/CuLfWjzxHv6pCkC8I0a6qljQNS9iOQc6blwIDAQAB\",\"iss\":\"gov.va.vamf.service.saml-sts\",\"userType\":\"VETERAN\"}]"
      - "IDP_CONFIG_JSON=[{\"idpId\": \"gov.va.iam.ssoe.v1\",\"friendlyName\": \"VAAFI SSOe\",\"description\": \"Veteran login supporting DSLogon, Symantec, and other CSPs.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/dslogon-logo.png\",\"loginUrl\": \"http://${HOST_DOMAIN}:9000/users/v1/landing\",\"logoutUrl\": \"http://iamssoe-proxy-mock/ssoeproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}:9000/ssoeproxy/logout\"},{\"idpId\": \"gov.va.iam.ssoi.v1\",\"friendlyName\": \"VAAFI SSOi\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"STAFF\",\"logoUrl\": \"img/logo_navbar_ipad.png\",\"loginUrl\": \"http://localhost:9001/users/v1/landing\",\"logoutUrl\": \"http://${HOST_DOMAIN}:9001/ssoiproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}/users/v1/landing\"},{\"idpId\": \"gov.va.mhv.v1\",\"friendlyName\": \"My HealtheVet\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/mhv-logo.png\",\"loginUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/login\",\"logoutUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}:8080/users/v1/landing\"}]"

  database:
    image: pgd-oracle-mock
    environment:
      - CONSUL_SERVER=consul:8500
      - CONSUL_PATH=/appconfig/${VAMF_ENVIRONMENT}/pgd-fhir-services
      - "CONSUL_TOKEN=${CONSUL_MASTER_TOKEN}"
      - USE_ENVCONSUL=true
    expose:
      - 1521
    ports:
      - 1522:1521
    healthcheck:
      test: ["CMD", "./entrypoint.sh", "./wait-for-database.sh"]
      interval: 20s
      timeout: 1m30s
      retries: 10
  pgd-ccda:
    image: dtr.mapsandbox.net/md/pgd-ccda-server
    expose:
      - 8086
    ports:
      - 8022:8085
    command: ["npm", "start"]
    environment:
      - SERVICE_TAGS=${VAMF_ENVIRONMENT}
      - SERVICE_NAME=pgd-ccda
      - USE_ENVCONSUL=true
  rbac-api:
    image: fhir-rbac-api-svc:latest
    environment:
      - "constraint:nodetype==*application*"
      - "CONSUL_SERVER=consul:8500"
      - CONSUL_PATH=/appconfig/${VAMF_ENVIRONMENT}/pgd-rbac-services
      - "CONSUL_TOKEN=${CONSUL_MASTER_TOKEN}"
      - JWT_ALGORITHM=HS512
      - SERVICE_TAGS=${VAMF_ENVIRONMENT}
      - SERVICE_9090_NAME=rbac-api
      - USE_ENVCONSUL=true
    ports:
      - 9090:9090
  pgd-fhir-services:
    image: dtr.mapsandbox.net/md/map/pgd-fhir-services
    environment:
      - RBAC_SERVER=http://rbac-api:9090/rbac
      - C322FHIR_ENDPOINT=http://pgd-ccda:8085/c32-to-fhir
      - CCDA2FHIR_ENDPOINT=http://pgd-ccda:8085/ccda-to-fhir
      - FHIR2CCDA_ENDPOINT=http://pgd-ccda:8085/fhir-to-ccda
      - CONSUL_SERVER=consul:8500
      - CONSUL_PATH=/appconfig/${VAMF_ENVIRONMENT}/pgd-fhir-services
      - "CONSUL_TOKEN=${CONSUL_MASTER_TOKEN}"
      - SERVICE_TAGS=${VAMF_ENVIRONMENT}
      - SERVICE_8080_NAME=pgd-fhir-services
      - USE_ENVCONSUL=true
      - PGD_FHIR_API_PORT=8000
      - JVM_OPTS=-Xmx6g -Xms4g -XX:MaxPermSize=1024m
    ports:
      - 7777:8080
    expose:
      - 8080
      - 9000
      - 8089
      - 8000
    links:
      - database
      - database:db
    depends_on:
      database:
        condition: service_healthy
      pgd-ccda:
        condition: service_started
      rbac-api:
        condition: service_started


  var-mongo-db-mock:
    image: dtr.mapsandbox.net/ckm/var-resources-mongo-mock:1.0.0
    container_name: var-mongo-db-mock
    ports:
      - "27017:27017"
    environment:
      - constraint:nodetype==*service*
      - SERVICE_NAME=var-mongo-db-mock
      - SERVICE_TAGS=${VAMF_ENVIRONMENT}
      - CONSUL_SERVER=consul:8500
      - JWT_PRIVATE_KEY=MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDBGzt361EC4riygMie4qnnWVNNNdY3yiRdHf+BIeIgH6ru9l4AZYDxQuMJi4QIt17y1Lo7HNnBKP+gzSRkFe4cpira6RYqNMSY7CWlBbi8GlfrRtzHmtfCgSNtxaCEr2hVbBjg7BsAnhNiSWRQdkLlu5D7xFTn27oUhZK/Y3cP1UGR9iwe+nc7hpdVoTx1nR3GV1R2/9Z4+guQJ5RiAuwbIOD/Oxm8OtfX7K82yM02YH+SwlKim0y/0J/JSlJex+i/7waEEK2DMO+CffaTDv3A+ytOSCcLQNG26/7LeoJdf5knpxsnfW1W6z0Bp1SfYKtYm6vr8pFiyeJBoSd8DjeHAgMBAAECggEATcnKiuQgHil2fXGjX12vU6KIC/JD+PVU8K3E3x/nF0mqcdiMxVweNRHco1uwNFKpzOgknOtiTI1XbE82+Zpb8O5/FPAQHbBkAbYe8/r6D8wM3poNFdsqTw/2VaHmp4yBWufQncp+liEXbeBiqIb7K9AC92h/S2cX7mxgUPigXZ+2V5Bvdjo2jAtdrq6nXFtzsqCxNKFpFifdV2TkFbq6vGB/mJdrFHspUiMZc2KAR7/pQCO/oR/WIyHRTBvWcM/zrd/7A6TZRKYMabYDn1dbyP/ATqyJ/rtx+7Josj+LogBVrdeD7USpdHj6FLbT/Z0N5o1tintUlj8eo1XqNupjAQKBgQD2VLTgiVphbju0YA65I1yWYuPYdDXJVkJjqv7lFndPdOGZsfysdc2fdkdAEkPVZhI5Tve8CvOW98WnVLkj/WRyfBVeVbekIGdsH/PWRTrLv5mXbpDGYP0z1c7FTMx6qiaE6ZLZATy4jWBLRPQcJj5rm70nO4Sajfo5TQW4BB+abQKBgQDIr7Dvq5AixiMSzbvhPIDqjIYQv+TCbzKoNm/JuRgE/1mxfgxuthNA8OLDBEmCa3SWUo9Slrq5KnynVMnxIMiTw9CSbLhUYxqlrP0ei6C7d1bv5N3tH4GD5ljCmobz04Dg56/bs/pbfJBjfE2qxtrEgzK51FazUzlFUwzf++vhQwKBgQCCUuRzWxfvLjP2RU/k0XmdsuoazbjbMYDkXEaJC27KIetttkYZNCY6tIgTtNYgo+UGXuogmaawe5wd4GwnR1uKWm2vwCftdJtjEDCgb3Yg79ihzoRYAF5Vu0uvBOe2Cilg7nabytTGSz3j9LI15mHl6rqTdCC+6Fi3UjGxXrUdrQKBgQCjPF0EJZ2A239N3TA0Hd2Saqjl2OA+0un2bwjwoPCLqBQRzkBYkRsKGKWqEMOmJLdZSmAvwlCxKoDoLoxv6MWdg4oUgABTC6VyG0pr3RDpS0HYsWVeaeEUI3oRGFYq39+VkH63iyZZ4fEkKsiV31e0vi61fqTjCg+sdsgjLCuKNwKBgQDhp8wfpcqYnvDvn7OKL52SiXfktTWe8xq6pVKLDrHScEUhj/vgcXkvOiELP+jnNivMU2AWObLq0Nf+JWpH4HrIH8R+Ag7sgy+mL53Ku+4I2et1JsHCc94AS59qY/C4AqZDgpFAFYKTNPRn+bQMAIRCh2dIayehKTgZpvhmxxSSvw==
      - JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB
      - "JWTISSUER_CONFIG_JSON=[{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"gov.va.mhv.idp.v1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"external.idp.test1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA17igsXGfpg3BRv1dr9jAyhyjGUpDSQ1CCIjQI/NZD+OoxoTlvPMmY8yQ3OfisnpE7zR+dNAdj7CHCiCbKgQKjPmOzdobKJD7N8538lxZ2wlHNko0rG3iyCKJVRJFMXirZfrPERlFj0AQrwhobIpuwyFQfsNTZPaxeaN35Bexo7fowu0LBkzvCioZfKq6QPxx8qQ0/wJYxeh3D4b5NWR1eIbWpJE5NbWYx0ZSs/TD5HQTAGsIvJN5+EKzVB1RZAp0UwdxDQE7BjpXBXx0PjZidCY2kH2jVm1OHd/xzkZiIt2EYe5Cpd/CuLfWjzxHv6pCkC8I0a6qljQNS9iOQc6blwIDAQAB\",\"iss\":\"gov.va.vamf.service.saml-sts\",\"userType\":\"VETERAN\"}]"
      - "IDP_CONFIG_JSON=[{\"idpId\": \"gov.va.iam.ssoe.v1\",\"friendlyName\": \"VAAFI SSOe\",\"description\": \"Veteran login supporting DSLogon, Symantec, and other CSPs.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/dslogon-logo.png\",\"loginUrl\": \"http://${HOST_DOMAIN}:9000/users/v1/landing\",\"logoutUrl\": \"http://iamssoe-proxy-mock/ssoeproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}:9000/ssoeproxy/logout\"},{\"idpId\": \"gov.va.iam.ssoi.v1\",\"friendlyName\": \"VAAFI SSOi\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"STAFF\",\"logoUrl\": \"img/logo_navbar_ipad.png\",\"loginUrl\": \"http://localhost:9001/users/v1/landing\",\"logoutUrl\": \"http://${HOST_DOMAIN}:9001/ssoiproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}/users/v1/landing\"},{\"idpId\": \"gov.va.mhv.v1\",\"friendlyName\": \"My HealtheVet\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/mhv-logo.png\",\"loginUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/login\",\"logoutUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/logout\",\"landingPage\": \"http://${HOST_DOMAIN}:8080/users/v1/landing\"}]"
      - CONSUL_TOKEN=${CONSUL_MASTER_TOKEN}
      - VAMF_ENVIRONMENT=${VAMF_ENVIRONMENT}
      - CONSUL_PATH=appconfig/${VAMF_ENVIRONMENT}/var-mongo-db-mock


  var-oracle-db-mock:
    image: dtr.mapsandbox.net/md/sustainment-oracle-db-mock:1.2
    container_name: var-oracle-db-mock
    ports:
      - "1521:1521"
    volumes:
      - ./healthchecks:/opt/healthchecks
    environment:
      - constraint:nodetype==*service*
      - SERVICE_NAME=var-oracle-db-mock
      - SERVICE_TAGS=${VAMF_ENVIRONMENT}
    healthcheck:
      test: ["CMD", "bash", "/opt/healthchecks/healthcheck-var-oracle-db-mock.sh"]
      interval: 1m
      timeout: 5s
      retries: 3



  web:
    container_name: pgd-fhir-services
    hostname: pgd-fhir-services
    image: mobileapps.vaftl.us:9250/md/map/pgd-fhir-services
    environment:
    - RBAC_SERVER=http://rbac-api:9090/rbac
    - RBAC_HEALTHCHECK=http://rbac-api:9090/
    - C322FHIR_ENDPOINT=http://ccda:8085/c32-to-fhir
    - CCDA2FHIR_ENDPOINT=http://ccda:8085/ccda-to-fhir
    - FHIR2CCDA_ENDPOINT=http://ccda:8085/fhir-to-ccda
    - FHIR2CCDA_HEALTHCHECK=http://ccda:8085/
    - "CONSUL_SERVER=consul:8500"
    - CONSUL_PATH=/appconfig/${VAMF_ENVIRONMENT}/pgd-fhir-services
    - CONSUL_TOKEN=${CONSUL_MASTER_TOKEN}
    - PGD_FHIR_API_PORT:8000
    - USE_ENVCONSUL=true
    build: .
    ports:
    - 8080:8080
    depends_on:
      database:
        condition: service_healthy
      pgd-ccda:
        condition: service_started
      rbac-api:
        condition: service_started
    expose:
    - 8080
    - 9000
    - 8089
    - 8000

  vista-emr-services:
    image: dtr.mapsandbox.net/ckm/vista-emr-service:2.0.0
    links:
      - user-services
    ports:
      - 9899:8080
    environment:
      - "USE_ENVCONSUL=true"
      - "CONSUL_SERVER=consul:8500"
      - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
      - "CONSUL_PATH=appconfig/local/vista-data-services/v1"
      - VIA_BASE_URL=http://mock-via:8080/via-webservices/via-webservices/services
      - REDIS_HOST=redis
      - USER_SVC_URL=http://user-services:8080/users/v1
      - CONSUMING_APP_PASSWORD=test_password
      - CONSUMING_APP_TOKEN=test_token
      - REQUESTING_APP=success
      - JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB

  # exposes vista data by using the mdws to via adapter
  vista-data-services:
    image: dtr.mapsandbox.net/docker-vista-data-services:1.5.4
    #image: vista-data-services
    links:
      - mdws-via-adapter
      - user-services
    ports:
      - 8085:8080
    expose:
      - 8080
      - 9000
      - 8089
      - 8000
    environment:
      # Don't use Vault
      #- "VAULT_ADDR=http://vault:8200"
      #- "SECRET_PATH=secret/local/vista-data-services"
      # Use Consul
      - "USE_ENVCONSUL=true"
      - "CONSUL_SERVER=consul:8500"
      - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
      - "CONSUL_PATH=appconfig/local/vista-data-services"
      - MDWS_ADAPTER_BASE_URL=http://mdws-via-adapter:8080/MdwsViaAdapter/v1/services
      - JAVA_OPTS=-Xms256m -Xmx512m -XX:-TieredCompilation -Xss256k -XX:+UseG1GC -XX:+UseStringDeduplication
      - USER_SVC_URL=http://user-services:8080/users/v1
      - JWT_SECRET=secretsecretsecret



  zipkin:
    image: dtr.mapsandbox.net/k8-pod-infra-containers/zipkin
    ports:
      - 9411:9411

  # redis for container state
  redis:
    image: dtr.mapsandbox.net/ckm/vamf-redis:1.0.0



  vamf-via-weblogic:
    build:
      context: .
      dockerfile: Dockerfile-via-weblogic
    image: dtr.mapsandbox.net/vamf-via-weblogic
    container_name: "via-weblogic-v4"
    hostname: "via-weblogic-v4"
    expose:
      - "7012"
      - "7022"
      - "8080"
      - "9000"
      - "9001"
    ports:
      - "8080"
    mem_limit: 1GB
    healthcheck:
      interval: 20s
      timeout: 1m30s
      retries: 10

  cdw-service:
    image: dtr.mapsandbox.net/md/map/cdw-services:2.0.1
    container_name: cdw-service
    ports:
      - 8072:8080
    environment:
      - "DB_MOBILEHEALTH_URL=jdbc:jtds:sqlserver://pie-cdw-mock:1433;databaseName=OIA_MOBILEHEALTH" ## new name
      - DB_MOBILEHEALTH_USERNAME=sa
      - DB_MOBILEHEALTH_PASSWORD=tk1ZXVsKmafZFt8p
      #       Settings for using utilize ckm mock for testing:
      #     - DB_MOBILEHEALTH_URL=jdbc:jtds:sqlserver://mock-cdw:1433;databaseName=OIA_MOBILEHEALTH ##
      #     - DB_MOBILEHEALTH_USERNAME=sa
      #     - DB_MOBILEHEALTH_PASSWORD=IS4skwnfuglx928361V
      - REDIS_HOST=redis
      - CORS_ALLOWED_ORIGIN=*
      - VAMF_ENVIRONMENT=${VAMF_ENVIRONMENT}
      - SERVICE_TAGS=${VAMF_ENVIRONMENT}
      - SERVICE_NAME=cdw-service
      - CONSUL_SERVER=${CONSUL_HTTP_ADDR}
      - CONSUL_TOKEN=${CONSUL_MASTER_TOKEN}
      - CONSUL_PATH=appconfig/${VAMF_ENVIRONMENT}/cdw-service
      - TRACE_URL=http://zipkin:9411/api/v1/spans
      - "JAVA_OPTS=-Xms64m -Xmx170m -XX:+UseSerialGC"

  pie-cdw-mock:
    image: pie-cdw-mock
    container_name: pie-cdw-mock
    hostname: pie-cdw-mock
    ports:
      - "1433:1433"
    environment:
      - SA_PASSWORD=tk1ZXVsKmafZFt8p
      - ACCEPT_EULA=Y
      - DB_MOBILEHEALTH_USERNAME=sa
      - DB_MOBILEHEALTH_PASSWORD=tk1ZXVsKmafZFt8p
      - DB_MOBILEHEALTH_URL=jdbc:jtds:sqlserver://pie-cdw-mock:1433
      - REDIS_HOST=redis
      - CORS_ALLOWED_ORIGIN=*
      - VAMF_ENVIRONMENT=${VAMF_ENVIRONMENT}
      - SERVICE_TAGS=${VAMF_ENVIRONMENT}
      - SERVICE_NAME=pie-cdw-mock
      - CONSUL_SERVER=${CONSUL_HTTP_ADDR}
      - CONSUL_TOKEN=${CONSUL_MASTER_TOKEN}
      - TRACE_URL=http://zipkin:9411/api/v1/spans
      - "JAVA_OPTS=-Xms64m -Xmx170m -XX:+UseSerialGC"