version: '2'
services:

  # Consul is our service registry. (https://github.com/hashicorp/consul)
  # Consul is configured to be exposed locally (http://${HOST_DOMAIN}:8500) to make it easier to change and manage configurations.
  consul:
    image: mobileapps.vaftl.us:9250/ckm/consul-server:latest
    command: "consul agent -server -bootstrap-expect=1 -ui -client 0.0.0.0 -data-dir /consul/data -config-dir /consul/config"
    volumes:
     - "/consul/data"
     - "/consul/config"
    ports:
     - "8500:8500"
     - "8600:8600/udp"

  # Registrator is a special container that monitors and registers other containers in Consul.
  # https://github.com/gliderlabs/registrator
  #
  # Registrator should use the special hostlocal.io (169.254.255.254) to communicate with services on the same development system. 169.254.X.X is a special IP that allows services on the same docker host (i.e. local network) to easily communicate through the host network- remember `${HOST_DOMAIN}`is connections *inside* each container, hostlocal is for communicating *between* containers on the same host.
  # (see https://en.wikipedia.org/wiki/Link-local_address)
  #
  # Tags flag in command is used to ensure that all services are registered to correct environment
  # (see https://github.com/gliderlabs/registrator/blob/master/registrator.go#L27)
  registrator:
    image: mobileapps.vaftl.us:9250/ckm/registrator:1.1.1
    command: "-tags local -internal consul://consul:8500"
    volumes:
    - /var/run/docker.sock:/tmp/docker.sock
    environment:
     - CONSUL_HTTP_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
    links:
    - consul

  # The API Gateway. Nginx with a few "enhancements":
  #
  # * Openresty: Framework that enables building Nginx plugins with Lua
  # * Consul-Template: Rewrites _nginx.conf_ based on Consul configurations
  #
  apigateway:
    image: mobileapps.vaftl.us:9250/ckm/apigateway:1.3.3
    ports:
      - "8089:80"
    environment:
    # Local consul instance. Point to central Consul server for non-development deployments
    - CONSUL_HTTP_ADDR=consul:8500
    - VAMF_ENVIRONMENT=local # The API Gateway will only map services tagged with same environment
    - USERSVC_URL=http://user-services:8080/users/v1/session/jwt
    - JWT_SECRET=testtesttest
    - SERVICE_80_NAME=apigateway
    - CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
    - "REGEX_AUTH_PROXY=.*"
    - "REGEX_RESTRICTED_HEADER=((^va_)|(^eauth_))/i"
    - "TRACE_URL=http://zipkin:9411/api/v1/spans"

# Mock for VIA data service
#  mock-via:
#    image: mobileapps.vaftl.us:9250/ckm/via-mock-service:1.0.5

### MDWS to VIA adapter
#  mdws-via-adapter:
#    image: mobileapps.vaftl.us:9250/ckm/mdws-via-adapter:1.2.14
#    links:
#    - mock-via
#    - user-services
#    - redis
#    ports:
#    - 8180:8180
#    environment:
#    # Vault
#    #- "VAULT_ADDR=http://vault:8200"
#    #- "SECRET_PATH=secret/local/mdws-via-adapter"
#    # Use Consul
#    - "USE_ENVCONSUL=true"
#    - "CONSUL_SERVER=consul:8500"
#    - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
#    - "CONSUL_PATH=appconfig/local/mdws-via-adapter"
#    - VIA_BASE_URL=http://mock-via:8080/via-webservices/via-webservices/services
#    - JAVA_OPTS=-Xms256m -Xmx512m -XX:-TieredCompilation -Xss256k -XX:+UseG1GC -XX:+UseStringDeduplication
#    - TRUSTSTORE_PASSWORD=changeit
#    - REDIS_HOST=redis
#    - JWT_REQUIRED_ROLE=STAFF
#    - USER_SVC_URL=http://user-services:8080/users/v1
#    - JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB


#  # VistA Data Services (VDS) - exposes vista data by using the mdws to via adapter
#  vista-data-services:
#    image: mobileapps.vaftl.us:9250/ckm/docker-vista-data-services:1.6.3
#    #image: vista-data-services
#    links:
#    - mdws-via-adapter
#    - user-services
#    ports:
#    - 8085:8080
#    environment:
#    # Don't use Vault
#    #- "VAULT_ADDR=http://vault:8200"
#    #- "SECRET_PATH=secret/local/vista-data-services"
#    # Use Consul
#    - "USE_ENVCONSUL=true"
#    - "CONSUL_SERVER=consul:8500"
#    - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
#    - "CONSUL_PATH=appconfig/local/vista-data-services"
#    - MDWS_ADAPTER_BASE_URL=http://mdws-via-adapter:8080/MdwsViaAdapter/v1/services
#    - JAVA_OPTS=-Xms256m -Xmx512m -XX:-TieredCompilation -Xss256k -XX:+UseG1GC -XX:+UseStringDeduplication
#    - USER_SVC_URL=http://user-services:8080/users/v1
#    #- JWT_SECRET=secretsecretsecret

  # User service and Mobile Veteran (Patient) Index (MVI/MPI)- The user service is responsible for processing requests
  # to create JWT security tokens and augmenting user identities with other identifiers from the MVI (specifically ICN)
  #
  mock-mvi:
#    image: dev/var-mock-mvi
    image: 181140462490.dkr.ecr.us-east-1.amazonaws.com/ablevets/var-mock-mvi:latest
    ports:
     - "8082:8080"

  user-services:
#    image: mobileapps.vaftl.us:9250/ckm/docker-user-service:1.6.19
    image: mobileapps.vaftl.us:9250/ckm/docker-user-service:1.7.0
    ports:
     - "8081:8080"
    environment:
# 1.6.19 configuration
#    - VAMF_ENVIRONMENT=local
#    #- VAULT_ADDR=http://vault:8200
#    - SECRET_PATH=secret/local/user-services
#    - USE_ENVCONSUL=true
#    - SERVER_USE_FORWARD_HEADERS=true
#    - TRACE_URL=http://zipkin:9411/api/v1/spans
#    - MVI_URL=http://mock-mvi:8080/mvi/mockVAIdMPort
#    - ROA_HOST=http://roa-services:8080
#    - MVI_SENDER_ID=CIH200
#    - MCI_PROCESSING_CODE=T
#    - JWT_SECRET=testtesttest
#    - JAVA_OPTS=-Xms256m -Xmx512m -XX:-TieredCompilation -Xss256k -XX:+UseG1GC -XX:+UseStringDeduplication
#    - SERVICE_TAGS=local
#    - CONSUL_SERVER=consul:8500
#    - CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
#    - CONSUL_PATH=appconfig/local/user-service
#    - APIGW_BASE_URL=http://localhost:8089
#    - WAYF_APP_URL=http://localhost:8089/wayf/v1/index.html
#    - "MVI_VISTA_FACILITIES=101,111,222,313,372,376,442,500,516,553,631,688,777,523"
#    - "JAVA_OPTS=-agentlib:jdwp=transport=dt_socket,address=8000,server=y,suspend=n"
#    - "JWTISSUER_CONFIG_JSON=[{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"gov.va.mhv.idp.v1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"external.idp.test1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA17igsXGfpg3BRv1dr9jAyhyjGUpDSQ1CCIjQI/NZD+OoxoTlvPMmY8yQ3OfisnpE7zR+dNAdj7CHCiCbKgQKjPmOzdobKJD7N8538lxZ2wlHNko0rG3iyCKJVRJFMXirZfrPERlFj0AQrwhobIpuwyFQfsNTZPaxeaN35Bexo7fowu0LBkzvCioZfKq6QPxx8qQ0/wJYxeh3D4b5NWR1eIbWpJE5NbWYx0ZSs/TD5HQTAGsIvJN5+EKzVB1RZAp0UwdxDQE7BjpXBXx0PjZidCY2kH2jVm1OHd/xzkZiIt2EYe5Cpd/CuLfWjzxHv6pCkC8I0a6qljQNS9iOQc6blwIDAQAB\",\"iss\":\"gov.va.vamf.service.saml-sts\",\"userType\":\"VETERAN\"}]"
#    - "IDP_CONFIG_JSON=[{\"idpId\": \"gov.va.iam.ssoe.v1\",\"friendlyName\": \"VAAFI SSOe\",\"description\": \"Veteran login supporting DSLogon, Symantec, and other CSPs.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/dslogon-logo.png\",\"loginUrl\": \"http://localhost:9000/users/v1/landing\",\"logoutUrl\": \"http://localhost:9000/ssoeproxy/logout\",\"vamfLandingPage\": \"http://localhost/users/v1/landing\"},{\"idpId\": \"gov.va.iam.ssoi.v1\",\"friendlyName\": \"VAAFI SSOi\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"STAFF\",\"logoUrl\": \"img/logo_navbar_ipad.png\",\"loginUrl\": \"http://localhost/vaafi/ssoimock/login\",\"logoutUrl\": \"http://localhost/vaafi/ssoemock/logout\",\"vamfLandingPage\": \"http://localhost/users/v1/landing\"},{\"idpId\": \"gov.va.mhv.v1\",\"friendlyName\": \"My HealtheVet\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/mhv-logo.png\",\"loginUrl\": \"http://localhost/vaafi/ssoimock/login\",\"logoutUrl\": \"http://localhost/vaafi/ssoemock/logout\",\"vamfLandingPage\": \"http://localhost/users/v1/landing\"}]"

# 1.7.0 configuration
    # Uncomment this section to use Vault
#    - VAULT_ADDR=http://vault:8200
#    - SECRET_PATH=secret/local/user-services
    # Use Consul
    - JWT_SECRET=testtesttest
    - JWT_PRIVATE_KEY=MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDBGzt361EC4riygMie4qnnWVNNNdY3yiRdHf+BIeIgH6ru9l4AZYDxQuMJi4QIt17y1Lo7HNnBKP+gzSRkFe4cpira6RYqNMSY7CWlBbi8GlfrRtzHmtfCgSNtxaCEr2hVbBjg7BsAnhNiSWRQdkLlu5D7xFTn27oUhZK/Y3cP1UGR9iwe+nc7hpdVoTx1nR3GV1R2/9Z4+guQJ5RiAuwbIOD/Oxm8OtfX7K82yM02YH+SwlKim0y/0J/JSlJex+i/7waEEK2DMO+CffaTDv3A+ytOSCcLQNG26/7LeoJdf5knpxsnfW1W6z0Bp1SfYKtYm6vr8pFiyeJBoSd8DjeHAgMBAAECggEATcnKiuQgHil2fXGjX12vU6KIC/JD+PVU8K3E3x/nF0mqcdiMxVweNRHco1uwNFKpzOgknOtiTI1XbE82+Zpb8O5/FPAQHbBkAbYe8/r6D8wM3poNFdsqTw/2VaHmp4yBWufQncp+liEXbeBiqIb7K9AC92h/S2cX7mxgUPigXZ+2V5Bvdjo2jAtdrq6nXFtzsqCxNKFpFifdV2TkFbq6vGB/mJdrFHspUiMZc2KAR7/pQCO/oR/WIyHRTBvWcM/zrd/7A6TZRKYMabYDn1dbyP/ATqyJ/rtx+7Josj+LogBVrdeD7USpdHj6FLbT/Z0N5o1tintUlj8eo1XqNupjAQKBgQD2VLTgiVphbju0YA65I1yWYuPYdDXJVkJjqv7lFndPdOGZsfysdc2fdkdAEkPVZhI5Tve8CvOW98WnVLkj/WRyfBVeVbekIGdsH/PWRTrLv5mXbpDGYP0z1c7FTMx6qiaE6ZLZATy4jWBLRPQcJj5rm70nO4Sajfo5TQW4BB+abQKBgQDIr7Dvq5AixiMSzbvhPIDqjIYQv+TCbzKoNm/JuRgE/1mxfgxuthNA8OLDBEmCa3SWUo9Slrq5KnynVMnxIMiTw9CSbLhUYxqlrP0ei6C7d1bv5N3tH4GD5ljCmobz04Dg56/bs/pbfJBjfE2qxtrEgzK51FazUzlFUwzf++vhQwKBgQCCUuRzWxfvLjP2RU/k0XmdsuoazbjbMYDkXEaJC27KIetttkYZNCY6tIgTtNYgo+UGXuogmaawe5wd4GwnR1uKWm2vwCftdJtjEDCgb3Yg79ihzoRYAF5Vu0uvBOe2Cilg7nabytTGSz3j9LI15mHl6rqTdCC+6Fi3UjGxXrUdrQKBgQCjPF0EJZ2A239N3TA0Hd2Saqjl2OA+0un2bwjwoPCLqBQRzkBYkRsKGKWqEMOmJLdZSmAvwlCxKoDoLoxv6MWdg4oUgABTC6VyG0pr3RDpS0HYsWVeaeEUI3oRGFYq39+VkH63iyZZ4fEkKsiV31e0vi61fqTjCg+sdsgjLCuKNwKBgQDhp8wfpcqYnvDvn7OKL52SiXfktTWe8xq6pVKLDrHScEUhj/vgcXkvOiELP+jnNivMU2AWObLq0Nf+JWpH4HrIH8R+Ag7sgy+mL53Ku+4I2et1JsHCc94AS59qY/C4AqZDgpFAFYKTNPRn+bQMAIRCh2dIayehKTgZpvhmxxSSvw==
    - JWT_PUBLIC_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwRs7d+tRAuK4soDInuKp51lTTTXWN8okXR3/gSHiIB+q7vZeAGWA8ULjCYuECLde8tS6OxzZwSj/oM0kZBXuHKYq2ukWKjTEmOwlpQW4vBpX60bcx5rXwoEjbcWghK9oVWwY4OwbAJ4TYklkUHZC5buQ+8RU59u6FIWSv2N3D9VBkfYsHvp3O4aXVaE8dZ0dxldUdv/WePoLkCeUYgLsGyDg/zsZvDrX1+yvNsjNNmB/ksJSoptMv9CfyUpSXsfov+8GhBCtgzDvgn32kw79wPsrTkgnC0DRtuv+y3qCXX+ZJ6cbJ31tVus9AadUn2CrWJur6/KRYsniQaEnfA43hwIDAQAB
    - USE_ENVCONSUL=true
    - CONSUL_SERVER=consul:8500
    - CONSUL_TOKEN=${CONSUL_TOKEN}
    - CONSUL_PATH=appconfig/${VAMF_ENVIRONMENT}/user-services
    - SERVER_USE_FORWARD_HEADERS=false
    - SERVICE_NAME=docker-user-service
    - MVI_URL=http://mock-mvi:8080/mvi/mockVAIdMPort
    - EULA_HOST=http://eula-service:8080
    - SUD_HOST=http://sud-service:8080
    - MVI_SENDER_ID=CIH200
    - MVI_PROCESSING_CODE=T
    - JAVA_OPTS=-agentlib:jdwp=transport=dt_socket,address=8000,server=y,suspend=n
    - JAVA_OPTS=-Xms128m -Xmx512m -XX:-TieredCompilation -Xss256k -XX:+UseG1GC -XX:+UseStringDeduplication
    - SERVICE_TAGS=${VAMF_ENVIRONMENT}
    - APIGW_BASE_URL=http://${HOST_DOMAIN}:8089
    - WAYF_APP_URL=http://${HOST_DOMAIN}:8089/wayf/v1/index.html
    - "MVI_VISTA_FACILITIES=101,111,222,313,372,376,442,500,516,553,598,631,688,777"
    - TRACE_URL=http://zipkin:9411/api/v1/spans
    - VAMF_ENVIRONMENT=${VAMF_ENVIRONMENT}
    - "JWTISSUER_CONFIG_JSON=[{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"gov.va.mhv.idp.v1\",\"userType\":\"VETERAN\"},{\"rsaPublicKeyB64\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtxwSTqAC49xXxWIX/kpb4EWXjnpN8ii5FbjAOmubKA32ZVHC+OSj14uRkKJp5EgU0aOO6cbm7jTnGjOFq+KC540qtBMP6/bd/rcXNCb7t8ajb2eWC1PdvYCrpXM/IAZvdrOGhc9sU+8DeZj2dJg+WIlWkrnXsHMbAd5ePt1mCx6NPADFBRVSJg9MAN04yzBAcgmAeOgcZGYqHcihov3hIi0UnAwi0wtBHIquGcRKhUAG5clOY3YxyNJZ2HWglrCHtz1sHe7OGFBfGGR18C+S6CK7GDB2zm3IkJ16uqf/F3s+tF7u88mE3t6gr/Y/1U6OH99xm1Ta0Yqzie351qEXSwIDAQAB\",\"iss\":\"external.idp.test1\",\"userType\":\"VETERAN\"}]"
    - "IDP_CONFIG_JSON=[{\"idpId\": \"gov.va.iam.ssoe.v1\",\"friendlyName\": \"VAAFI SSOe\",\"description\": \"Veteran login supporting DSLogon, Symantec, and other CSPs.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/dslogon-logo.png\",\"loginUrl\": \"http://${HOST_DOMAIN}:9000/users/v1/landing\",\"logoutUrl\": \"http://${HOST_DOMAIN}:9000/ssoeproxy/logout\",\"vamfLandingPage\": \"http://${HOST_DOMAIN}/users/v1/landing\"},{\"idpId\": \"gov.va.iam.ssoi.v1\",\"friendlyName\": \"VAAFI SSOi\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"STAFF\",\"logoUrl\": \"img/logo_navbar_ipad.png\",\"loginUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/login\",\"logoutUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/logout\",\"vamfLandingPage\": \"http://${HOST_DOMAIN}:8080/users/v1/landing\"},{\"idpId\": \"gov.va.mhv.v1\",\"friendlyName\": \"My HealtheVet\",\"description\": \"Staff login supporting PIV authentication.\",\"versionId\": \"v1\",\"scope\": \"VETERAN\",\"logoUrl\": \"img/mhv-logo.png\",\"loginUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/login\",\"logoutUrl\": \"http://${HOST_DOMAIN}:8080/ssoiproxy/logout\",\"vamfLandingPage\": \"http://${HOST_DOMAIN}:8080/users/v1/landing\"}]"
    - "REDIS_HOST=redis"


  # Administrative Data Repository (ADR) Service and Mock (SOAP) data source. ADR serves as a enterprise data service
  # that allows VA apps to retrieve patient demographic and next-of-kin information
  #
#  mock-adr:
#    image: mobileapps.vaftl.us:9250/ckm/docker-adr-mock
#
#  adr-services:
#    image: mobileapps.vaftl.us:9250/ckm/docker-adr-service:1.0.8
#    ports:
#     - "8083:8080"
#    links:
#    - mock-adr
#    - zipkin
#    depends_on:
#      - mock-adr
#    environment:
#    - VAMF_ENVIRONMENT=local
#    # Don't use Vault, ADR doesn't have any secrets in local-dev
#    #- VAULT_ADDR=http://vault:8200
#    #- SECRET_PATH=secret/local/adr-service
#    # Use Consul
#    - USE_ENVCONSUL=true
#    - CONSUL_SERVER=consul:8500
#    - CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
#    - CONSUL_PATH=appconfig/local/adr-service
#    - ENDPOINT_URL=http://mock-adr:8080/adr/mockeeSummaryPortSoap11
#    - CORS_ALLOWED_ORIGIN=*
#    - JWT_SECRET=testtesttest
#    - JAVA_OPTS=-Xms256m -Xmx512m -XX:-TieredCompilation -Xss256k -XX:+UseG1GC -XX:+UseStringDeduplication
#    - SERVICE_TAGS=local
#    - TRACE_URL=http://zipkin:9411/api/v1/spans
#    - SERVICE_NAME=docker-adr-service


  ## Swagger UI for working with contracts
  swagger-ui:
    image: swaggerapi/swagger-ui
    ports:
     - "8091:8080"

  # Where Are You From? (WAYF) web App. WAYF is a CSS/HTML/JS client-side web application.
  wayf-web:
    image: mobileapps.vaftl.us:9250/ckm/wayf-app:1.0.3
    ports:
    - 8092:80
    environment:
    - SERVICE_TAGS=local
    - SERVICE_80_NAME=wayf-web

  # Provider Context Selector (PCS) Web App. PCS is a CSS/HTML/JS client-side web application.
  pcs-web:
    image: mobileapps.vaftl.us:9250/ckm/pcs-web:1.0.1
    ports:
    - 8093:80
    environment:
    - SERVICE_TAGS=local
    - SERVICE_80_NAME=pcs-web


 # HDR Mock
#  hdr-mock:
#    image: mobileapps.vaftl.us:9250/ckm/docker-hdr-mock:latest
#
#  # HDR Service
#  hdr-service:
#    image: mobileapps.vaftl.us:9250/ckm/docker-hdr-service:1.0.5
#    environment:
#      - VAMF_ENVIRONMENT=local
#      # Use Consul
#      - USE_ENVCONSUL=true
#      - CONSUL_SERVER=consul:8500
#      - CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF
#      - CONSUL_PATH=appconfig/local/hdr-service
#      - HDR_ENDPOINT_URL=http://hdr-mock:8080/hdr/mockPathwaysHttpBinding
#      - HDR_URL=http://hdr-mock:8080/hdr/mockPathwaysHttpBinding
#      - CORS_ALLOWED_ORIGIN=*
#      - SERVICE_NAME=hdr-service
#
#    links:
#      - hdr-mock
#    ports:
#      - 8094:8080


# Mongo mock for quartz and notifications, username/pass authentication turned on by default
# SSL turned off by default
  mongo:
    image: mobileapps.vaftl.us:9250/ckm/mock-mongo:1.0.0
    expose:
     - "27017"
    ports:
     - "27017"
    environment:
    - MONGODB_ADMIN_USER=admin
    - MONGODB_ADMIN_PASS=adminpass
    - MONGODB_APPLICATION_DATABASE=notificationsdb, remindersdb, taskresourcesdb
    - MONGODB_APPLICATION_USER=testuser
    - MONGODB_APPLICATION_PASS=testpass
    - SSL_ENABLED=false
    - AUTH_ENABLED=true
    - JOURNALING=true


#Quartz Scheduler
#  vamf-quartz-scheduler:
#    image: mobileapps.vaftl.us:9250/ckm/vamf-quartz-scheduler:1.4.0
#    ports:
#      - "8097:8080"
#    environment:
#    - "VAMF_ENVIRONMENT=local"
#    # Use Vault
#    - VAULT_ADDR=http://vault:8200
#    - SECRET_PATH=secret/local/quartz-scheduler
#    # Use consul
#    - USE_ENVCONSUL=true
#    - "CONSUL_SERVER=consul:8500"
#    - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
#    - "CONSUL_PATH=appconfig/local/quartz-scheduler"
#    #- "MONGO_NOTIFICATIONS_URI=mongodb://mongo:27017/notificationsdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
#    - "MONGO_NOTIFICATIONS_URI=mongodb://testuser:testpass@mongo:27017/notificationsdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
#    - "SMTP_HOST=mock-smtp-server"
#    - "SMTP_PORT=3465"
#    - "SMTP_SENDER=mailsender@localhost.com"
#    - "SMTP_USERNAME=mailsender@localhost.com"
#    - "SMTP_PASSWORD=password"
#    - "SMTP_AUTH=false"
#    - "SMTP_CONNECTIONTIMEOUT=10000"
#    - "SMTP_TIMEOUT=10000"
#    - "SMTP_STARTTLS_ENABLED=true"
#    - "SMTP_SSL_TRUST=*"
#    - "ORACLEDB_URL=jdbc:oracle:thin:@qss-mock:1521:xe"
#    #- "ORACLEDB_USER=HADB" #set in vault
#    #- "ORACLEDB_PASSWORD=m0ckpass01" #set in vault
#    depends_on:
#      - mongo
#      - qss-mock
#      - vault
#    links:
#      - mongo
#      - qss-mock
#      - vault
#      - mock-smtp-server

# QSS Mock
#  qss-mock:
#    image: mobileapps.vaftl.us:9250/ckm/docker-roa-mock:1.0.3
#    #image: roa-mock-test
#    ports:
#     - "1521"

#VAMF Notification Services
#  vamf-notification-services:
#    image: mobileapps.vaftl.us:9250/ckm/vamf-notification-services:1.4.0
#    ports:
#      - "8100:8080"
#    environment:
#    - "VAMF_ENVIRONMENT=local"
#    # No Secrets don't Use Vault
#    #- VAULT_ADDR=http://vault:8200
#    #- SECRET_PATH=secret/local/pns
#    # Use consul
#    - USE_ENVCONSUL=true
#    - "CONSUL_SERVER=consul:8500"
#    - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
#    - "CONSUL_PATH=appconfig/local/pns"
#    - "JAVA_OPTS=-Xms256m -Xmx512m -XX:-TieredCompilation -Xss256k -XX:+UseG1GC -XX:+UseStringDeduplication"
#    - "QSS_BASE_URL=http://vamf-quartz-scheduler:8080/qss/v1"
#    # Uncomment if running the mongo mock without authentication
#    #- "MONGO_NOTIFICATIONS_URI=mongodb://mongo:27017/notificationsdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
#    #- "MONGO_REMINDERS_URI=mongodb://mongo:27017/remindersdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
#    - "MONGO_NOTIFICATIONS_URI=mongodb://testuser:testpass@mongo:27017/notificationsdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
#    - "MONGO_REMINDERS_URI=mongodb://testuser:testpass@mongo:27017/remindersdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
#    - SERVICE_TAGS=local
#    - SERVICE_NAME=vamf-notification-services
#    depends_on:
#      - mongo
#      - vamf-quartz-scheduler
#    links:
#      - mongo
#      - vamf-quartz-scheduler
#      - vault
#      - mock-smtp-server
#    restart: on-failure

# Task Resources
#  task-resources:
#    image: mobileapps.vaftl.us:9250/ckm/task-resources:1.0.4
#    ports:
#      - "8099:8080"
#    environment:
#      - "VAMF_ENVIRONMENT=local"
#      # No Secrets don't Use Vault
#      #- VAULT_ADDR=http://vault:8200
#      #- SECRET_PATH=secret/local/pns
#      # Use consul
#      - "USE_ENVCONSUL=false"
#      - "CONSUL_SERVER=consul:8500"
#      - "CONSUL_TOKEN=7BE784A4-7498-4469-BE2F-9C3B9444DFEF"
#      - "CONSUL_PATH=appconfig/local/task-resources"
#      - "MONGODB_TASK_RESOURCES_DB=mongodb://mongo:27017/taskresourcesdb?ssl=false&connectTimeoutMS=20000&maxPoolSize=100"
#      - "SERVICE_NAME=task-resources"
#    depends_on:
#    - mongo
#    links:
#    - mongo

#vault server for managing secrets
  vault:
    image: mobileapps.vaftl.us:9250/ckm/vault-server:latest
    environment:
      - VAULT_LOCAL_CONFIG={"storage":{"consul":{"address":"http://consul:8500", "token":"${CONSUL_TOKEN}", "path":"vault", "scheme":"http"}}}
    ports:
      - 8202:8200
    links:
      - consul

# redis for container state
  redis:
    image: mobileapps.vaftl.us:9250/ckm/vamf-redis:1.0.0

# Mock SMTP server for use with PNS and QSS
#  mock-smtp-server:
#    image: mobileapps.vaftl.us:9250/ckm/mock-smtp-server:1.0.0
#    expose:
#      - "3025"
#      - "3465"
#      - "3110"
#      - "3995"
#      - "3143"
#      - "3993"

# Third party as is mocks
  zipkin:
    image: mobileapps.vaftl.us:9250/ckm/k8-pod-infra-containers/zipkin
    ports:
      - "9411:9411"

networks:
  default:
    external:
      name: varnextgenlocalenvironment_default
